<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$Kimify - Kim Jong Un Streaming Platform</title>
  <!-- Favicon -->
  <link rel="icon" href="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09ec69edb8dc3456829f1_kimmy.png" type="image/png">
  <style>
    /* Font imports */
    @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-family: 'Varela Round', sans-serif;
    }
    
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .sidebar {
      width: 240px;
      background-color: #181818;
      padding: 24px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #333;
    }
    
    .logo {
      display: flex;
      align-items: center;
      margin-bottom: 32px;
    }
    
    .logo-img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 8px;
      object-fit: cover;
    }
    
    .logo span {
      font-size: 24px;
      font-weight: bold;
    }
    
    .nav-link {
      display: flex;
      align-items: center;
      color: #b3b3b3;
      text-decoration: none;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    .nav-link:hover {
      color: #fff;
    }
    
    .nav-link i {
      margin-right: 16px;
      font-size: 20px;
    }
    
    .create-playlist {
      background-color: #121212;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .create-playlist h3 {
      margin-bottom: 8px;
    }
    
    .create-playlist p {
      font-size: 13px;
      color: #b3b3b3;
      margin-bottom: 12px;
    }
    
    .input-group {
      display: flex;
    }
    
    .input-group input {
      flex: 1;
      background-color: #333;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px 0 0 4px;
      font-size: 14px;
    }
    
    .input-group button {
      background-color: #444;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 14px;
    }
    
    .social-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
    }
    
    .social-link {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .social-link:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    
    .playlists-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      margin-top: 24px;
      text-transform: uppercase;
      font-size: 12px;
      color: #b3b3b3;
      font-weight: bold;
    }
    
    .playlists-header i {
      cursor: pointer;
      font-size: 16px;
      width: 24px;
      height: 24px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .playlists-header i:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .playlists-list {
      list-style: none;
      overflow-y: auto;
      max-height: 500px;
    }
    
    .playlists-list li {
      color: #b3b3b3;
      margin-bottom: 8px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 6px 0;
    }
    
    .playlists-list li:hover {
      color: #fff;
    }
    
    .playlist-mini-img {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      margin-right: 10px;
      object-fit: cover;
      background-color: #333;
    }
    
    .main-content {
      flex: 1;
      background: linear-gradient(180deg, #5E287D 0%, #121212 100%);
      overflow-y: auto;
      padding: 32px;
    }
    /* Apply styles to prevent text selection for all text elements */
    h1, h2, h3, p, div, span, a, li {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .song-img-container {
      width: 100%;
      aspect-ratio: 1;
      margin-bottom: 0;
      overflow: hidden;
      background-color: #282828;
      position: relative;
    }
    
    .song-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .song-card:hover .song-img {
      transform: scale(1.05);
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .header h1 {
      font-size: 28px;
      font-weight: bold;
      font-family: 'Comfortaa', cursive;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .social-links {
      display: flex;
      gap: 10px;
      margin-right: 10px;
    }
    
    .social-link {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
      transform-origin: center;
    }
    
    .social-link:nth-child(1) {
      transform: rotate(-5deg);
    }
    
    .social-link:nth-child(2) {
      transform: rotate(0deg);
    }
    
    .social-link:nth-child(3) {
      transform: rotate(5deg);
    }
    
    .social-link:hover {
      transform: scale(1.15) rotate(0deg);
      z-index: 2;
    }
    
    .social-icon-wrapper {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 5px;
      overflow: hidden;
    }
    
    .social-link:nth-child(1) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 14px;
    }
    
    .social-link:nth-child(2) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 50%;
    }
    
    .social-link:nth-child(3) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 14px;
    }
    
    .social-icon {
      width: 85%;
      height: 85%;
      object-fit: contain;
    }
    
    .songs-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }
    
    @media (max-width: 1200px) {
      .songs-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (max-width: 992px) {
      .songs-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .songs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .song-card {
      background-color: #181818;
      padding: 0;
      border-radius: 8px;
      transition: background-color 0.3s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    
    .song-card:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: transparent;
      transition: background-color 0.3s;
      pointer-events: none;
      z-index: 1;
    }
    
    .song-card:hover:before {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .song-card img {
      pointer-events: none; /* Prevents image flickering issues */
      -webkit-user-drag: none;
    }
    
    .song-info-container {
      padding: 16px;
    }
    
    .song-title {
      font-weight: bold;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: 'Comfortaa', cursive;
    }
    
    .song-artist {
      font-size: 13px;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .song-img-container {
      width: 100%;
      aspect-ratio: 1;
      margin-bottom: 8px;
      border-radius: 4px;
      overflow: hidden;
      background-color: #282828;
    }
    
    .song-img-placeholder {
      width: 100%;
      height: 100%;
      background-color: #282828;
      position: relative;
    }
    
    .song-img-placeholder:after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(80, 80, 80, 0.2) 0%, rgba(40, 40, 40, 0.2) 100%);
    }
    
    .song-title {
      font-weight: bold;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .song-artist {
      font-size: 13px;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .section-title {
      font-size: 22px;
      font-weight: bold;
      margin: 32px 0 24px;
    }
    .player {
      height: 90px;
      background-color: #181818;
      border-top: 1px solid #333;
      display: flex;
      align-items: center;
      padding: 0 16px;
      position: relative;
    }
    
    /* Windows 98 Style Error Dialog */
    .error-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .error-dialog {
      width: 400px;
      background-color: #c0c0c0;
      border: 3px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
      color: #000;
      font-family: 'Courier New', monospace;
      padding: 2px;
      position: relative;
    }
    
    .error-title-bar {
      background: linear-gradient(90deg, #000080, #1084d0);
      color: white;
      font-weight: bold;
      padding: 3px 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .error-title-bar .close-btn {
      background-color: #c0c0c0;
      border: 2px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      color: #000;
      width: 16px;
      height: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      cursor: pointer;
    }
    
    .error-content {
      padding: 10px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .error-content img {
      width: 40px;
      height: 40px;
    }
    
    .error-message {
      flex: 1;
      font-size: 12px;
    }
    
    .error-buttons {
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    
    .error-button {
      background-color: #c0c0c0;
      border: 2px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      color: #000;
      padding: 4px 10px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      cursor: pointer;
    }
    
    .error-button:active {
      border: 2px solid #808080;
      border-right-color: #ffffff;
      border-bottom-color: #ffffff;
    }
    
    .now-playing {
      width: 30%;
      display: flex;
      align-items: center;
    }
    
    .now-playing-img-container {
      width: 56px;
      height: 56px;
      border-radius: 4px;
      overflow: hidden;
      background-color: #333;
      margin-right: 12px;
    }
    
    .now-playing-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .now-playing-img-placeholder {
      width: 100%;
      height: 100%;
      background-color: #333;
      position: relative;
    }
    
    .player-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 8px;
    }
    
    .player-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      width: 40%;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 4px;
    }
    
    .player-timeline-container {
      display: flex;
      align-items: center;
      width: 100%;
      gap: 8px;
    }
    
    .player-timeline {
      flex: 1;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      position: relative;
      cursor: pointer;
    }
    
    .timeline-progress {
      height: 100%;
      width: 0%;
      background-color: #b3b3b3;
      border-radius: 2px;
      position: relative;
    }
    
    .timeline-handle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 50%;
      right: 0;
      transform: translate(50%, -50%);
      display: none;
      cursor: grab;
    }
    
    .player-timeline:hover {
      height: 6px;
    }
    
    .player-timeline:hover .timeline-progress {
      background-color: #1DB954;
    }
    
    .player-timeline:hover .timeline-handle {
      display: block;
    }
    
    #current-time, #song-duration {
      font-size: 12px;
      color: #b3b3b3;
      min-width: 40px;
    }
    
    .player-timeline {
      width: 500px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    
    .timeline {
      flex: 1;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      position: relative;
    }
    
    .timeline-progress {
      height: 100%;
      width: 30%;
      background-color: #b3b3b3;
      border-radius: 2px;
    }
    
    .control-buttons i {
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
    }
    
    .control-buttons i:hover {
      color: #fff;
    }
    
    .play-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: white;
      border: none;
      color: black;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }
    .volume-slider-container {
      position: relative;
      width: 100px;
    }
    
    .volume-bar {
      width: 100%;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    .volume-progress {
      height: 100%;
      width: 70%;
      background-color: #b3b3b3;
      border-radius: 2px;
      transition: width 0.1s ease;
    }
    
    .volume-handle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 50%;
      right: 30%; /* 100% - 70% (default volume) */
      transform: translate(50%, -50%);
      display: none;
      cursor: grab;
    }
    
    .volume-bar:hover {
      height: 6px;
    }
    
    .volume-bar:hover .volume-progress {
      background-color: #1DB954;
    }
    
    .volume-bar:hover .volume-handle {
      display: block;
    }
    
    .volume-controls {
      width: 30%;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
      justify-content: flex-end;
    }
    
    /* Adding icons */
    .icon {
      margin-right: 12px;
      width: 20px;
      text-align: center;
    }
    
    /* Search container */
    .search-container {
      margin-bottom: 24px;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      padding: 10px 40px 10px 40px;
      background-color: #242424;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 14px;
    }
    
    .search-input:focus {
      outline: none;
      background-color: #333;
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
    }
    
    .clear-search {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      cursor: pointer;
      display: none;
    }
    
    /* Playlist View */
    .playlist-header {
      display: flex;
      margin-bottom: 24px;
    }
    
    .playlist-cover {
      width: 200px;
      height: 200px;
      background-color: #282828;
      margin-right: 24px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .playlist-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .playlist-info {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding-bottom: 16px;
    }
    
    .playlist-type {
      text-transform: uppercase;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .playlist-title {
      font-size: 42px;
      font-weight: bold;
      margin-bottom: 8px;
      font-family: 'Comfortaa', cursive;
    }
    
    .playlist-description {
      font-size: 14px;
      color: #b3b3b3;
      margin-bottom: 16px;
    }
    
    .playlist-meta {
      font-size: 14px;
      color: #b3b3b3;
    }
    
    .playlist-songs {
      width: 100%;
      border-collapse: collapse;
    }
    
    .playlist-songs th {
      text-align: left;
      padding: 8px 16px;
      color: #b3b3b3;
      font-size: 12px;
      font-weight: normal;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .playlist-songs td {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 14px;
    }
    
    .playlist-songs tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .song-number {
      color: #b3b3b3;
      width: 40px;
    }
    
    .song-cell {
      display: flex;
      align-items: center;
    }
    
    .song-cell-img {
      width: 40px;
      height: 40px;
      margin-right: 16px;
      background-color: #333;
    }
    
    .song-cell-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .song-cell-info {
      display: flex;
      flex-direction: column;
    }
    
    .song-cell-title {
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .song-cell-artist {
      font-size: 12px;
      color: #b3b3b3;
    }
    /* Like button */
    .like-btn {
      color: #b3b3b3;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s;
      margin-left: 12px;
    }
    
    .like-btn:hover, .like-btn.active {
      color: #1DB954;
      transform: scale(1.1);
    }
    
    .like-btn.active {
      color: #1DB954;
    }
    
    .heart-icon {
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
    }
    
    /* Hide the original heart icon when active */
    .like-btn.active .fa-heart-o {
      display: none;
    }
    
    /* Show the filled heart icon when active */
    .like-btn.active .fa-heart {
      display: inline-block;
    }
    
    /* Hide the filled heart icon by default */
    .fa-heart {
      display: none;
    }
    
    /* Loading spinner */
    .loader {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      width: 400px;
      background-color: #282828;
      border-radius: 8px;
      padding: 24px;
    }
    
    .modal-header {
      margin-bottom: 24px;
    }
    
    .modal-header h2 {
      font-size: 24px;
      font-weight: bold;
    }
    
    .modal-form-group {
      margin-bottom: 16px;
    }
    
    .modal-form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #b3b3b3;
    }
    
    .modal-form-group input, .modal-form-group textarea {
      width: 100%;
      padding: 10px;
      background-color: #333;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 14px;
    }
    
    .modal-form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .modal-form-group input:focus, .modal-form-group textarea:focus {
      outline: none;
      background-color: #3a3a3a;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
      margin-top: 24px;
    }
    
    .modal-btn {
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    
    .modal-btn-cancel {
      background-color: transparent;
      color: white;
    }
    
    .modal-btn-cancel:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .modal-btn-primary {
      background-color: #1DB954;
      color: white;
    }
    
    .modal-btn-primary:hover {
      background-color: #1ed760;
    }
    
    .modal-form-group .image-preview {
      width: 100%;
      height: 120px;
      background-color: #333;
      border-radius: 4px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #b3b3b3;
      position: relative;
      overflow: hidden;
    }
    
    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Image selector */
    .image-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .image-option {
      width: 60px;
      height: 60px;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .image-option.selected {
      border-color: #1DB954;
    }
    
    .image-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Song selection styles */
    .song-selection {
      max-height: 200px;
      overflow-y: auto;
      background-color: #333;
      border-radius: 4px;
      padding: 10px;
    }
    
    .song-selection-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .song-selection-item:hover {
      background-color: #444;
    }
    
    .song-selection-item input {
      margin-right: 8px;
    }
    
    .song-selection-item label {
      display: flex;
      align-items: center;
      cursor: pointer;
      flex: 1;
    }
    
    .song-selection-img {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      margin-right: 12px;
      object-fit: cover;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #333;
      }
      .player-timeline {
        width: 200px;
      }
    }

    /* Kimify Wrapped Modal Styles */
    .wrapped-modal-content {
      width: 80%;
      max-width: 900px;
      max-height: 90vh;
      background-color: #282828;
      border-radius: 8px;
      overflow-y: auto;
      position: relative;
    }

    .wrapped-modal-header {
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #333;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .wrapped-modal-header h2 {
      font-size: 24px;
      font-weight: bold;
      font-family: 'Comfortaa', cursive;
      color: white;
      margin: 0;
    }

    .wrapped-close-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .wrapped-close-btn:hover {
      color: white;
    }

    /* Wrapped Content Styles */
    .wrapped-container {
      background: linear-gradient(135deg, #c00000 0%, #8b0000 100%);
      border-radius: 0 0 8px 8px;
      padding: 32px;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .wrapped-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09ec69edb8dc3456829f1_kimmy.png');
      background-repeat: repeat;
      background-size: 100px;
      opacity: 0.05;
      pointer-events: none;
    }
    
    .wrapped-year {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 8px;
      font-family: 'Comfortaa', cursive;
    }
    
    .wrapped-title {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 40px;
      font-family: 'Comfortaa', cursive;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 768px) {
      .stats-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 480px) {
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
    
    .stat-card {
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      transition: transform 0.3s, background-color 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .stat-icon {
      font-size: 36px;
      margin-bottom: 16px;
      opacity: 0.8;
    }
    
    .stat-number {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 8px;
      font-family: 'Comfortaa', cursive;
    }
    
    .stat-label {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.8);
    }
    .top-songs-section {
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 32px;
    }
    
    .top-songs-section h2 {
      font-size: 24px;
      margin-bottom: 24px;
      font-family: 'Comfortaa', cursive;
    }
    
    .top-songs-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .top-song-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    
    .top-song-item:hover {
      background-color: rgba(0, 0, 0, 0.4);
    }
    
    .top-song-number {
      font-size: 24px;
      font-weight: bold;
      min-width: 40px;
      text-align: center;
    }
    
    .top-song-img {
      width: 60px;
      height: 60px;
      border-radius: 6px;
      overflow: hidden;
      margin-right: 16px;
      background-color: #333;
    }
    
    .top-song-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .top-song-info {
      flex: 1;
    }
    
    .top-song-title {
      font-weight: bold;
      margin-bottom: 4px;
      font-family: 'Comfortaa', cursive;
    }
    
    .top-song-artist {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .top-song-plays {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-left: 16px;
    }
    
    .share-section {
      text-align: center;
    }
    
    .share-btn {
      background-color: #282828;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .share-btn:hover {
      background-color: #333;
    }
    
    .share-warning {
      margin-top: 8px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
    }

    .meme-modal-content {
    width: 90%;
    max-width: 1100px;
    max-height: 90vh;
    background-color: #282828;
    border-radius: 8px;
    overflow-y: auto;
    position: relative;
  }
  
  .meme-modal-header {
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #333;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .meme-modal-header h2 {
    font-size: 24px;
    font-weight: bold;
    font-family: 'Comfortaa', cursive;
    color: white;
    margin: 0;
  }
  
  .meme-close-btn {
    background: none;
    border: none;
    color: #b3b3b3;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }
  
  .meme-close-btn:hover {
    color: white;
  }
  
  .meme-modal-body {
    padding: 24px;
  }
  
  .meme-container {
    display: flex;
    gap: 24px;
    margin-bottom: 32px;
  }
  
  @media (max-width: 900px) {
    .meme-container {
      flex-direction: column;
    }
    
    .meme-preview {
      width: 100% !important;
    }
  }
  
  .meme-editor {
    flex: 1;
  }
  
  .editor-section {
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
  }
  
  .editor-section h3 {
    margin-bottom: 12px;
    font-size: 16px;
    font-weight: bold;
    font-family: 'Comfortaa', cursive;
  }
  
  .template-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  
  .template-item {
    background-color: #333;
    border-radius: 8px;
    overflow: hidden;
    aspect-ratio: 1;
    cursor: pointer;
    transition: transform 0.2s, border 0.2s;
    border: 3px solid transparent;
  }
  
  .template-item:hover {
    transform: scale(1.05);
  }
  
  .template-item.selected {
    border-color: #1DB954;
  }
  
  .template-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .caption-inputs {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .input-group {
    display: flex;
    flex-direction: column;
  }
  
  .input-group label {
    font-size: 14px;
    margin-bottom: 6px;
    color: #b3b3b3;
  }
  
  .input-group input {
    padding: 10px 14px;
    background-color: #333;
    border: none;
    border-radius: 4px;
    color: white;
    font-size: 14px;
  }
  
  .input-group input:focus {
    outline: none;
    background-color: #3a3a3a;
  }
  
  .style-options {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .option-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  
  .option-group label {
    font-size: 14px;
    color: #b3b3b3;
  }
  
  .color-buttons, .stroke-buttons, .background-buttons {
    display: flex;
    gap: 8px;
  }
  
  .color-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid #444;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s;
  }
  
  .color-btn:hover, .stroke-btn:hover, .bg-btn:hover {
    transform: scale(1.1);
  }
  
  .color-btn.selected, .stroke-btn.selected, .bg-btn.selected {
    border: 2px solid #1DB954;
  }
  
  .stroke-btn, .bg-btn {
    padding: 6px 10px;
    background-color: #333;
    border: 2px solid #444;
    border-radius: 4px;
    color: white;
    font-size: 12px;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s;
  }
  
  .meme-preview {
    width: 400px;
  }
  
  .preview-container {
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .meme-canvas-container {
    width: 100%;
    aspect-ratio: 1;
    position: relative;
    overflow: hidden;
  }
  
  #meme-canvas {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: none;
    border-radius: 4px;
  }
  
  .preview-message {
    position: absolute;
    color: #b3b3b3;
    font-size: 14px;
  }
  
  .preview-actions {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 10px;
    margin-bottom: 16px;
  }
  
  .action-btn {
    padding: 10px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    border: none;
    transition: background-color 0.2s, transform 0.2s;
  }
  
  .action-btn:hover:not(:disabled) {
    transform: translateY(-2px);
  }
  
  .generate-btn {
    background-color: #1DB954;
    color: white;
  }
  
  .generate-btn:hover {
    background-color: #1ed760;
  }
  
  .download-btn {
    background-color: #7e57c2;
    color: white;
  }
  
  .download-btn:hover:not(:disabled) {
    background-color: #9575cd;
  }
  
  .share-btn {
    background-color: #007bff;
    color: white;
  }
  
  .share-btn:hover:not(:disabled) {
    background-color: #0069d9;
  }
  
  .download-btn:disabled, .share-btn:disabled {
    background-color: #555;
    cursor: not-allowed;
    transform: none;
  }
  
  .approval-notice {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 12px;
    color: #b3b3b3;
  }
  
  .recent-memes {
    margin-top: 24px;
  }
  
  .recent-memes h3 {
    margin-bottom: 12px;
    font-size: 16px;
    font-weight: bold;
    font-family: 'Comfortaa', cursive;
  }
  
  .recent-memes-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }
  
  @media (max-width: 768px) {
    .recent-memes-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media (max-width: 576px) {
    .recent-memes-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  .empty-memes-message {
    grid-column: 1 / -1;
    text-align: center;
    color: #b3b3b3;
    padding: 24px;
    background-color: #1e1e1e;
    border-radius: 8px;
  }
  
  .recent-meme-item {
    border-radius: 6px;
    overflow: hidden;
    aspect-ratio: 1;
    position: relative;
    cursor: pointer;
    transition: transform 0.2s;
    background-color: #333;
  }
  
  .recent-meme-item:hover {
    transform: scale(1.05);
  }
  
  .recent-meme-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .map-modal-content {
    width: 90%;
    max-width: 1000px;
    max-height: 90vh;
    background-color: #282828;
    border-radius: 8px;
    overflow-y: auto;
    position: relative;
  }
  
  .map-modal-header {
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #333;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .map-modal-header h2 {
    font-size: 24px;
    font-weight: bold;
    font-family: 'Comfortaa', cursive;
    color: white;
    margin: 0;
  }
  
  .map-close-btn {
    background: none;
    border: none;
    color: #b3b3b3;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }
  
  .map-close-btn:hover {
    color: white;
  }
  
  .map-modal-body {
    padding: 24px;
  }
  
  .map-stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 24px;
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 16px;
  }
  
  .stats-item {
    text-align: center;
    flex: 1;
  }
  
  .stats-number {
    font-size: 32px;
    font-weight: bold;
    font-family: 'Comfortaa', cursive;
    margin-bottom: 4px;
  }
  
  .stats-label {
    font-size: 14px;
    color: #b3b3b3;
  }
  
  .map-container {
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 24px;
    position: relative;
    height: 500px;
    overflow: hidden;
    border: 2px solid #c00000;
  }
  
  .map-overlay-text {
    position: absolute;
    bottom: 16px;
    right: 16px;
    font-size: 16px;
    font-family: 'Comfortaa', cursive;
    color: rgba(255, 255, 255, 0.7);
    text-align: right;
    font-weight: bold;
  }
  
  #north-korea-map-container {
    width: 100%;
    height: 100%;
    position: relative;
  }
  
  #nk-map-svg {
    width: 100%;
    height: 100%;
  }
  
  .city {
    cursor: pointer;
    transition: r 0.3s;
  }
  
  .city:hover {
    r: 20;
  }
  
  .map-tooltip {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.8);
    border-radius: 4px;
    padding: 8px 12px;
    color: white;
    font-size: 14px;
    pointer-events: none;
    z-index: 5;
    border: 1px solid #c00000;
  }
  
  .tooltip-city {
    font-weight: bold;
    margin-bottom: 4px;
  }
  
  .map-footer {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 24px;
  }
  
  .map-legend {
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 16px;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  
  .legend-circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: #c00000;
    margin-right: 12px;
    border: 2px solid white;
  }
  
  .legend-line {
    width: 30px;
    height: 3px;
    background-color: #333;
    margin-right: 12px;
    position: relative;
  }
  
  .legend-line:before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-top: 3px dashed #333;
  }
  
  .legend-text {
    font-size: 14px;
    color: #b3b3b3;
  }
  
  .realtime-updates {
    background-color: #1e1e1e;
    border-radius: 8px;
    padding: 16px;
  }
  
  .update-title {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 12px;
    font-family: 'Comfortaa', cursive;
    color: #c00000;
  }
  
  .update-feed {
    max-height: 200px;
    overflow-y: auto;
  }
  
  .update-item {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 14px;
    color: #b3b3b3;
  }
  
  .update-item:last-child {
    border-bottom: none;
  }
  
  @media (max-width: 768px) {
    .map-footer {
      grid-template-columns: 1fr;
    }
    
    .map-container {
      height: 400px;
    }
  }
  
  /* Blinking pulse animation for cities */
  @keyframes pulse {
    0% {
      r: 15;
      opacity: 1;
    }
    50% {
      r: 25;
      opacity: 0.6;
    }
    100% {
      r: 15;
      opacity: 1;
    }
  }
  
  .pulse {
    animation: pulse 2s infinite;
  }

  .nk-map-image-container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .nk-map-image {
    max-width: 80%;
    max-height: 80%;
    object-fit: contain;
  }
  
  .city-marker {
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: #c00000;
    border: 2px solid white;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    z-index: 2;
  }
  
  .city-marker:hover {
    transform: translate(-50%, -50%) scale(1.5);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }
  
  /* Adjust marker sizes based on listener count */
  .city-marker[data-listeners="1245"] {
    width: 30px;
    height: 30px;
  }
  
  .city-marker[data-listeners="367"],
  .city-marker[data-listeners="301"] {
    width: 24px;
    height: 24px;
  }
  
  /* Pulsing animation for city markers */
  @keyframes pulse {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.7;
    }
    100% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
  }
  
  .pulse {
    animation: pulse 2s infinite;
  }
  </style>
  <!-- Adding Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
      <div class="sidebar">
        <div class="logo">
          <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09ec69edb8dc3456829f1_kimmy.png" alt="Kimify Logo" class="logo-img">
          <span>Kimify</span>
        </div>
        
        <nav>
          <a href="#" class="nav-link" id="home-link">
            <span class="icon"><i class="fas fa-home"></i></span>
            <span>Home</span>
          </a>
          <a href="#" class="nav-link" id="search-link">
            <span class="icon"><i class="fas fa-search"></i></span>
            <span>Search</span>
          </a>
          <a href="#" class="nav-link" id="recently-played-link">
            <span class="icon"><i class="fas fa-history"></i></span>
            <span>Recently Played</span>
          </a>
          <a href="#" class="nav-link" id="liked-songs-link">
            <span class="icon"><i class="fas fa-heart"></i></span>
            <span>Liked Songs</span>
          </a>
          <a href="#" class="nav-link" id="wrapped-link">
            <span class="icon"><i class="fas fa-chart-bar"></i></span>
            <span>Kimify Wrapped</span>
          </a>
        </nav>
        
        <div class="playlists-header">
          <span>PLAYLISTS</span>
          <i class="fas fa-plus" id="add-playlist-btn"></i>
        </div>
        
        <ul class="playlists-list" id="playlists-container">
          <!-- Playlists will be loaded here -->
          <div class="loader"></div>
        </ul>
      </div>
      
      <div class="main-content" id="main-content">
        <!-- Main content will change based on selected view -->
        <div id="home-view">
          <div class="header">
            <h1>$KIMIFY CA: 4nuXMaRVDcUTCCt7sAZ68G9wz9vsutHJ37TYmgbcpump</h1>
            <div class="header-right">
              <div class="social-links">
                <a href="https://twitter.com/kimifysol" target="_blank" class="social-link">
                  <div class="social-icon-wrapper">
                    <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0930241517bce72bf2df2_Logo_of_Twitter.svg.png" alt="Twitter" class="social-icon">
                  </div>
                </a>
                <a href="https://pump.fun/coin/4nuXMaRVDcUTCCt7sAZ68G9wz9vsutHJ37TYmgbcpump" target="_blank" class="social-link">
                  <div class="social-icon-wrapper">
                    <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09302ce2c79cb6daaebcc_Pump_fun_logo%20(2).png" alt="pump.fun" class="social-icon">
                  </div>
                </a>
                <a href="https://dexscreener.com" target="_blank" class="social-link">
                  <div class="social-icon-wrapper">
                    <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e093028190f33913455b57_dex-screener-seeklogo.png" alt="DexScreener" class="social-icon">
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="songs-grid" id="songs-grid">
            <!-- Song cards will be loaded here -->
          </div>
        </div>
        <div id="search-view" style="display: none;">
            <div class="header">
              <h1>Search</h1>
            </div>
            
            <div class="search-container">
              <i class="fas fa-search search-icon"></i>
              <input type="text" class="search-input" id="search-input" placeholder="Search for songs or artists...">
              <i class="fas fa-times clear-search" id="clear-search"></i>
            </div>
            
            <div id="search-results">
              <!-- Search results will appear here -->
              <div class="search-message" id="search-message">
                <p>Start typing to search</p>
              </div>
            </div>
          </div>
    
          <div id="recently-played-view" style="display: none;">
            <div class="header">
              <h1>Recently Played</h1>
            </div>
            
            <div id="recently-played-container">
              <!-- Recently played songs will appear here -->
              <p class="empty-message" id="recently-played-empty" style="display: none;">
                You haven't played any songs yet.
              </p>
            </div>
          </div>
    
          <div id="liked-songs-view" style="display: none;">
            <div class="header">
              <h1>Liked Songs</h1>
            </div>
            
            <div id="liked-songs-container">
              <!-- Liked songs will appear here -->
              <p class="empty-message" id="liked-songs-empty" style="display: none;">
                You haven't liked any songs yet.
              </p>
            </div>
          </div>
    
          <div id="playlist-view" style="display: none;">
            <!-- Playlist view will be populated dynamically -->
          </div>
        </div>
        
        <!-- New Kimify Wrapped Modal -->
        <div id="wrapped-modal" class="modal-overlay" style="display: none;">
          <div class="wrapped-modal-content">
            <div class="wrapped-modal-header">
              <h2>Kimify Wrapped</h2>
              <button class="wrapped-close-btn" onclick="closeWrappedModal()">Ã—</button>
            </div>
            
            <div class="wrapped-container">
              <div class="wrapped-year">2025</div>
              <div class="wrapped-title">Supreme Leader's Year in Review</div>
              
              <div class="stats-container">
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-rocket"></i></div>
                  <div class="stat-number">10</div>
                  <div class="stat-label">Failed Missile Launches</div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-cut"></i></div>
                  <div class="stat-number">5</div>
                  <div class="stat-label">New Haircuts Approved</div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-smile"></i></div>
                  <div class="stat-number">0</div>
                  <div class="stat-label">Happy Residents</div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-newspaper"></i></div>
                  <div class="stat-number">147</div>
                  <div class="stat-label">Western Media Outlets Banned</div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-utensils"></i></div>
                  <div class="stat-number">3</div>
                  <div class="stat-label">Grams of Rice Per Citizen</div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon"><i class="fas fa-medal"></i></div>
                  <div class="stat-number">842</div>
                  <div class="stat-label">New Medals Added to Military Uniform</div>
                </div>
              </div>
              
              <div class="top-songs-section">
                <h2>Top Propaganda Hits</h2>
                <div class="top-songs-list">
                  <div class="top-song-item">
                    <div class="top-song-number">1</div>
                    <div class="top-song-img">
                      <img src="images/kim1.png" alt="Top song">
                    </div>
                    <div class="top-song-info">
                      <div class="top-song-title">Death to America (Dance Remix)</div>
                      <div class="top-song-artist">Kim Jong Un ft. The Moranbong Band</div>
                    </div>
                    <div class="top-song-plays">Played 458 times</div>
                  </div>
                  
                  <div class="top-song-item">
                    <div class="top-song-number">2</div>
                    <div class="top-song-img">
                      <img src="images/kim2.png" alt="Top song">
                    </div>
                    <div class="top-song-info">
                      <div class="top-song-title">My Nuclear Button Is Bigger</div>
                      <div class="top-song-artist">Kim Jong Un</div>
                    </div>
                    <div class="top-song-plays">Played 312 times</div>
                  </div>
                  
                  <div class="top-song-item">
                    <div class="top-song-number">3</div>
                    <div class="top-song-img">
                      <img src="images/kim3.png" alt="Top song">
                    </div>
                    <div class="top-song-info">
                      <div class="top-song-title">Internet? Never Heard of It</div>
                      <div class="top-song-artist">Kim Jong Un</div>
                    </div>
                    <div class="top-song-plays">Played 203 times</div>
                  </div>
                </div>
              </div>
              
              <div class="share-section">
                <button class="share-btn">Share With The West (Not Recommended)</button>
                <p class="share-warning">Warning: Sharing may result in re-education.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="player">
        <div class="now-playing">
          <div class="now-playing-img-container" id="current-song-img-container">
            <div class="now-playing-img-placeholder"></div>
          </div>
          <div class="song-info">
            <div class="song-title" id="current-song-title">Select a song</div>
            <div class="song-artist" id="current-song-artist"></div>
          </div>
          <div class="like-btn" id="current-song-like">
            <span class="heart-icon">
              <i class="fa fa-heart-o"></i>
              <i class="fa fa-heart"></i>
            </span>
          </div>
        </div>
        
        <div class="player-controls">
          <div class="control-buttons">
            <i class="fas fa-step-backward"></i>
            <button class="play-btn" onclick="togglePlay()">
              <i class="fas fa-play" id="play-icon"></i>
            </button>
            <i class="fas fa-step-forward"></i>
            <i class="fas fa-repeat"></i>
          </div>
          <div class="player-timeline-container">
            <span id="current-time">0:00</span>
            <div class="player-timeline">
              <div class="timeline-progress" id="song-progress"></div>
              <div class="timeline-handle" id="progress-handle"></div>
            </div>
            <span id="song-duration">0:00</span>
          </div>
        </div>
        
        <div class="volume-controls">
          <i class="fas fa-volume-up" id="volume-icon"></i>
          <div class="volume-slider-container">
            <div class="volume-bar">
              <div class="volume-progress"></div>
              <div class="volume-handle"></div>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Audio element to handle actual playback -->
      <audio id="audio-player" src=""></audio>
      
      <!-- Supabase JS Library -->
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
      <script>
          // Prevent text selection to avoid flickering
          document.addEventListener('mousedown', function(e) {
            if (e.detail > 1) {
              e.preventDefault();
            }
          }, false);
          
          // Initialize Supabase Client - Replace with your actual project values
          const supabaseUrl = 'https://nxonhlsbiwiejcjfkrvv.supabase.co';
          const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54b25obHNiaXdpZWpjamZrcnZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI3ODEzOTQsImV4cCI6MjA1ODM1NzM5NH0.0qjK26i5EvACQJKTfnEMUTD89DzzOswCO1PeQz8omVA'; // Get this from your Supabase project settings
          const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
          // Mock data for songs
        const songs = [
          { 
            id: 'song1', 
            title: 'Hasnt started yet',
            artist: 'Kim Jong Un', 
            imageFile: 'kim1.png', 
            audioFile: 'kim1.mp3' 
          },
          { 
            id: 'song2', 
            title: 'Miss You Ye (Rocket Man)', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim2.png', 
            audioFile: 'kim2.mp3' 
          },
          { 
            id: 'song3', 
            title: 'rapstuff', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim3.png', 
            audioFile: 'kim3.mp3' 
          },
          { 
            id: 'song4', 
            title: 'gym flow', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim4.png', 
            audioFile: 'kim4.mp3' 
          },
          { 
            id: 'song5', 
            title: 'Sad Kimmy', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim5.png', 
            audioFile: 'kim5.mp3' 
          },
          { 
            id: 'song6', 
            title: 'Kim Style', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim6.png', 
            audioFile: 'kim6.mp3' 
          },
          { 
            id: 'song7', 
            title: 'firework', 
            artist: 'Kim Jong Un', 
            imageFile: 'kim7.png', 
            audioFile: 'kim7.mp3' 
          },
          { 
            id: 'song8', 
            title: 'Dynamite', 
            artist: 'BTS', 
            imageFile: 'BTS.png', 
            audioFile: 'bts.mp3' 
          }
        ];
        
        // Default playlists
        const defaultPlaylists = [
          {
            id: 'playlist1',
            name: 'hasnt started yet',
            description: 'The best songs from our Great Leader',
            image: 'kim1.png',
            songs: ['song1', 'song2', 'song3']
          },
          {
            id: 'playlist2',
            name: 'Kim is the Greatest',
            description: 'A collection of hits celebrating our Supreme Leader',
            image: 'kim2.png',
            songs: ['song2', 'song4', 'song6']
          },
          {
            id: 'playlist3',
            name: 'PYONGYANG ANTHEM',
            description: 'Official anthems of our glorious capital',
            image: 'kim3.png',
            songs: ['song3', 'song5', 'song7']
          }
        ];
        
        // Keep track of the current song and play state
        let currentSong = null;
        let isPlaying = false;
        const audioPlayer = document.getElementById('audio-player');
        
        // Initialize volume
        audioPlayer.volume = 0.7; // 70% volume by default
        
        // Track whether we're dragging the timeline handle
        let isDraggingProgress = false;
        let isDraggingVolume = false;
        
        // Local storage keys
        const LIKED_SONGS_KEY = 'kimify-liked-songs';
        const RECENTLY_PLAYED_KEY = 'kimify-recently-played';
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
  // Existing initialization code
  loadSongs();
  setupNavigation();
  initSearch();
  loadPlaylists();
  document.getElementById('current-song-like').addEventListener('click', toggleLikeSong);
  setVolumePercent(audioPlayer.volume);
  document.getElementById('add-playlist-btn').addEventListener('click', showAddPlaylistModal);
  addNewStyles();
  
  // Add new feature initializations
  addMapNavLink();
  addMemeNavLink();
  
  // Setup share button in the wrapped modal
  const setupShareButton = function() {
    const shareButton = document.querySelector('.share-btn');
    if (shareButton) {
      shareButton.addEventListener('click', showErrorDialog);
    }
  };
  
  // Try to set up immediately
  setupShareButton();
  
  // Also try after a short delay in case the DOM isn't fully loaded
  setTimeout(setupShareButton, 1000);
});
        
        // Function to add styles for Supabase implementation
        function addNewStyles() {
          const styleElement = document.createElement('style');
          styleElement.textContent = `
            /* Upload image preview */
            .image-preview {
              width: 100%;
              height: 150px;
              background-color: #333;
              border-radius: 4px;
              display: flex;
              align-items: center;
              justify-content: center;
              overflow: hidden;
              margin-top: 8px;
            }
            
            .image-preview img {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }
            
            #cover-upload {
              background-color: #333;
              color: white;
              padding: 8px;
              border-radius: 4px;
              width: 100%;
            }
          `;
          document.head.appendChild(styleElement);
        }
        
        // Function to load songs to the home view
        function loadSongs() {
          const songsGrid = document.getElementById('songs-grid');
          songsGrid.innerHTML = '';
          
          songs.forEach(song => {
            const songCard = document.createElement('div');
            songCard.className = 'song-card';
            songCard.dataset.songId = song.id;
            
            if (song.id === 'song8') {
              // BTS song should show the error dialog
              songCard.onclick = showErrorDialog;
            } else {
              songCard.onclick = () => playSong(song.id);
            }
            
            songCard.innerHTML = `
              <div class="song-img-container">
                <img src="images/${song.imageFile}" alt="${song.title}" class="song-img">
              </div>
              <div class="song-info-container">
                <div class="song-title">${song.title}</div>
                <div class="song-artist">${song.artist}</div>
              </div>
            `;
            
            songsGrid.appendChild(songCard);
          });
        }
        // Function to load playlists
        async function loadPlaylists() {
          const playlistsContainer = document.getElementById('playlists-container');
          
          // Show loading indicator
          playlistsContainer.innerHTML = '<div class="loader"></div>';
          
          try {
            // Get user-created playlists from Supabase
            const { data: userPlaylists, error } = await supabase
              .from('playlists')
              .select('*')
              .order('created_at', { ascending: false });
            
            if (error) throw error;
            
            // Combine with default playlists
            const allPlaylists = [...defaultPlaylists];
            
            // Add user playlists if any were returned
            if (userPlaylists && userPlaylists.length > 0) {
              allPlaylists.push(...userPlaylists);
            }
            
            playlistsContainer.innerHTML = '';
            
            allPlaylists.forEach(playlist => {
              const li = document.createElement('li');
              li.dataset.playlistId = playlist.id;
              li.onclick = () => loadPlaylistView(playlist.id);
              
              const imageUrl = playlist.is_user_created 
                ? playlist.image_url // Use URL for user-created playlists
                : `images/${playlist.image}`; // Use local path for default playlists
              
              li.innerHTML = `
                <img src="${imageUrl}" alt="${playlist.name}" class="playlist-mini-img">
                ${playlist.name}
              `;
              
              playlistsContainer.appendChild(li);
            });
          } catch (error) {
            console.error('Error loading playlists:', error);
            
            // Fallback to just loading default playlists
            setTimeout(() => {
              playlistsContainer.innerHTML = '';
              
              defaultPlaylists.forEach(playlist => {
                const li = document.createElement('li');
                li.dataset.playlistId = playlist.id;
                li.onclick = () => loadPlaylistView(playlist.id);
                
                li.innerHTML = `
                  <img src="images/${playlist.image}" alt="${playlist.name}" class="playlist-mini-img">
                  ${playlist.name}
                `;
                
                playlistsContainer.appendChild(li);
              });
            }, 500);
          }
        }
        
        // Function to setup navigation
        function setupNavigation() {
          // Home
          document.getElementById('home-link').addEventListener('click', function() {
            showView('home-view');
          });
          
          // Search
          document.getElementById('search-link').addEventListener('click', function() {
            showView('search-view');
          });
          
          // Recently Played
          document.getElementById('recently-played-link').addEventListener('click', function() {
            showView('recently-played-view');
            loadRecentlyPlayed();
          });
          
          // Liked Songs
          document.getElementById('liked-songs-link').addEventListener('click', function() {
            showView('liked-songs-view');
            loadLikedSongs();
          });
          
          // Kimify Wrapped - now open as modal instead of view
          document.getElementById('wrapped-link').addEventListener('click', function() {
            showWrappedModal();
          });
        }
        
        // Function to show the wrapped modal
        function showWrappedModal() {
          document.getElementById('wrapped-modal').style.display = 'flex';
          // Animate the statistics
          setTimeout(animateWrappedStats, 300);
        }

        // Function to close the wrapped modal
        function closeWrappedModal() {
          document.getElementById('wrapped-modal').style.display = 'none';
        }
        
        // Function to show a specific view
        function showView(viewId) {
          // Hide all views
          document.querySelectorAll('#main-content > div').forEach(view => {
            view.style.display = 'none';
          });
          
          // Show the selected view
          document.getElementById(viewId).style.display = 'block';
        }
        // Function to initialize search functionality
        function initSearch() {
          const searchInput = document.getElementById('search-input');
          const clearSearch = document.getElementById('clear-search');
          const searchResults = document.getElementById('search-results');
          const searchMessage = document.getElementById('search-message');
          
          // Handle input event
          searchInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();
            
            if (query.length > 0) {
              clearSearch.style.display = 'block';
              searchMessage.style.display = 'none';
              
              // Filter songs based on query
              const filteredSongs = songs.filter(song => 
                song.title.toLowerCase().includes(query) || 
                song.artist.toLowerCase().includes(query)
              );
              
              // Display results
              if (filteredSongs.length > 0) {
                displaySearchResults(filteredSongs);
              } else {
                searchResults.innerHTML = `
                  <div class="search-message">
                    <p>No results found for "${query}"</p>
                  </div>
                `;
              }
            } else {
              clearSearch.style.display = 'none';
              searchResults.innerHTML = '';
              searchMessage.style.display = 'block';
            }
          });
          
          // Clear search button
          clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            searchInput.focus();
            clearSearch.style.display = 'none';
            searchResults.innerHTML = '';
            searchMessage.style.display = 'block';
          });
        }
        
        // Function to display search results
        function displaySearchResults(results) {
          const searchResults = document.getElementById('search-results');
          
          searchResults.innerHTML = `
            <h2 class="section-title">Results</h2>
            <table class="playlist-songs">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                ${results.map((song, index) => `
                  <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                    <td class="song-number">${index + 1}</td>
                    <td>
                      <div class="song-cell">
                        <div class="song-cell-img">
                          <img src="images/${song.imageFile}" alt="${song.title}">
                        </div>
                        <div class="song-cell-info">
                          <div class="song-cell-title">${song.title}</div>
                          <div class="song-cell-artist">${song.artist}</div>
                        </div>
                      </div>
                    </td>
                    <td>3:45</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
        // Function to load a specific playlist view
        async function loadPlaylistView(playlistId) {
          // Check if it's a default playlist
          const defaultPlaylist = defaultPlaylists.find(p => p.id === playlistId);
          
          if (defaultPlaylist) {
            // Handle default playlist
            const playlistSongs = defaultPlaylist.songs.map(songId => 
              songs.find(s => s.id === songId)
            ).filter(Boolean);
            
            displayPlaylist(defaultPlaylist, playlistSongs);
          } else {
            // It's a user-created playlist, fetch from Supabase
            try {
              const { data: playlist, error } = await supabase
                .from('playlists')
                .select('*')
                .eq('id', playlistId)
                .single();
              
              if (error) throw error;
              
              // Get the songs
              const playlistSongs = playlist.songs.map(songId => 
                songs.find(s => s.id === songId)
              ).filter(Boolean);
              
              displayPlaylist(playlist, playlistSongs);
            } catch (error) {
              console.error('Error loading playlist:', error);
              alert('An error occurred while loading the playlist. Please try again.');
            }
          }
        }
        
        // Helper function to display a playlist
        function displayPlaylist(playlist, playlistSongs) {
          const playlistView = document.getElementById('playlist-view');
          
          const imageUrl = playlist.is_user_created 
            ? playlist.image_url 
            : `images/${playlist.image}`;
          
          playlistView.innerHTML = `
            <div class="playlist-header">
              <div class="playlist-cover">
                <img src="${imageUrl}" alt="${playlist.name}">
              </div>
              <div class="playlist-info">
                <div class="playlist-type">Playlist</div>
                <h1 class="playlist-title">${playlist.name}</h1>
                <div class="playlist-description">${playlist.description}</div>
                <div class="playlist-meta">
                  ${playlistSongs.length} songs
                  ${playlist.is_user_created ? 'â€¢ Created by a user' : ''}
                </div>
              </div>
            </div>
            
            <table class="playlist-songs">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                ${playlistSongs.map((song, index) => `
                  <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                    <td class="song-number">${index + 1}</td>
                    <td>
                      <div class="song-cell">
                        <div class="song-cell-img">
                          <img src="images/${song.imageFile}" alt="${song.title}">
                        </div>
                        <div class="song-cell-info">
                          <div class="song-cell-title">${song.title}</div>
                          <div class="song-cell-artist">${song.artist}</div>
                        </div>
                      </div>
                    </td>
                    <td>3:45</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
          
          // Show the playlist view
          showView('playlist-view');
        }
        
        // Function to play a song
        function playSong(songId) {
          // Find the song
          const song = songs.find(s => s.id === songId);
          
          if (!song) return;
          
          currentSong = song;
          
          // Update the current song display
          document.getElementById('current-song-title').textContent = song.title;
          document.getElementById('current-song-artist').textContent = song.artist;
          
          // Set the image in the player
          const currentSongImg = document.createElement('img');
          currentSongImg.src = `images/${song.imageFile}`;
          currentSongImg.alt = song.title;
          currentSongImg.className = 'now-playing-img';
          
          const imgContainer = document.getElementById('current-song-img-container');
          imgContainer.innerHTML = '';
          imgContainer.appendChild(currentSongImg);
          
          // Set the audio source
          audioPlayer.src = `audio/${song.audioFile}`;
          
          // Play the song
          audioPlayer.load();
          audioPlayer.play().catch(e => {
            console.log("Audio playback failed. This is normal if no audio file exists yet.", e);
          });
          
          isPlaying = true;
          updatePlayButton();
          
          // Update like button state
          updateLikeButton();
          
          // Add to recently played
          addToRecentlyPlayed(songId);
        }
        // Function to toggle play/pause
        function togglePlay() {
          if (!currentSong) return;
          
          if (isPlaying) {
            audioPlayer.pause();
          } else {
            audioPlayer.play().catch(e => {
              console.log("Audio playback failed.", e);
            });
          }
          
          isPlaying = !isPlaying;
          updatePlayButton();
        }
        
        // Update the play/pause button icon
        function updatePlayButton() {
          const playIcon = document.getElementById('play-icon');
          playIcon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        }
        
        // Format time in minutes:seconds
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          seconds = Math.floor(seconds % 60);
          return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Update progress bar and time displays based on actual audio playback
        audioPlayer.addEventListener('timeupdate', function() {
          if (audioPlayer.duration && !isDraggingProgress) {
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            const progressBar = document.getElementById('song-progress');
            const progressHandle = document.getElementById('progress-handle');
            
            progressBar.style.width = `${percent}%`;
            progressHandle.style.right = `${100 - percent}%`;
            
            // Update time displays
            document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
            document.getElementById('song-duration').textContent = formatTime(audioPlayer.duration);
          }
        });
        
        // When metadata is loaded, update the duration display
        audioPlayer.addEventListener('loadedmetadata', function() {
          document.getElementById('song-duration').textContent = formatTime(audioPlayer.duration);
        });
        
        // Timeline seeking with dragging
        const playerTimeline = document.querySelector('.player-timeline');
        const progressHandle = document.getElementById('progress-handle');
        
        playerTimeline.addEventListener('mousedown', function(e) {
          if (!currentSong) return;
          
          const timeline = this;
          const rect = timeline.getBoundingClientRect();
          const percent = (e.clientX - rect.left) / rect.width;
          
          if (e.target === progressHandle) {
            // Start dragging the handle
            isDraggingProgress = true;
            document.addEventListener('mousemove', handleProgressDrag);
            document.addEventListener('mouseup', stopProgressDrag);
          } else {
            // Just a click, seek immediately
            seekToPercent(percent);
          }
        });
        
        function handleProgressDrag(e) {
          const timeline = document.querySelector('.player-timeline');
          const rect = timeline.getBoundingClientRect();
          let percent = (e.clientX - rect.left) / rect.width;
          
          // Clamp between 0 and 1
          percent = Math.max(0, Math.min(1, percent));
          
          // Update visuals but don't seek yet
          document.getElementById('song-progress').style.width = `${percent * 100}%`;
          progressHandle.style.right = `${100 - (percent * 100)}%`;
          document.getElementById('current-time').textContent = formatTime(percent * audioPlayer.duration);
        }
        
        function stopProgressDrag(e) {
          isDraggingProgress = false;
          document.removeEventListener('mousemove', handleProgressDrag);
          document.removeEventListener('mouseup', stopProgressDrag);
          
          // Now seek to the final position
          const timeline = document.querySelector('.player-timeline');
          const rect = timeline.getBoundingClientRect();
          let percent = (e.clientX - rect.left) / rect.width;
          percent = Math.max(0, Math.min(1, percent));
          
          seekToPercent(percent);
        }
        
        function seekToPercent(percent) {
          if (!audioPlayer.duration) return;
          
          audioPlayer.currentTime = percent * audioPlayer.duration;
          
          // Update displays
          document.getElementById('song-progress').style.width = `${percent * 100}%`;
          progressHandle.style.right = `${100 - (percent * 100)}%`;
          document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
        }
        // Volume control with dragging
        const volumeBar = document.querySelector('.volume-bar');
        const volumeHandle = document.querySelector('.volume-handle');
        const volumeProgress = document.querySelector('.volume-progress');
        
        volumeBar.addEventListener('mousedown', function(e) {
          const volumeBarRect = volumeBar.getBoundingClientRect();
          let percent = (e.clientX - volumeBarRect.left) / volumeBarRect.width;
          percent = Math.max(0, Math.min(1, percent));
          
          if (e.target === volumeHandle) {
            // Start dragging
            isDraggingVolume = true;
            document.addEventListener('mousemove', handleVolumeDrag);
            document.addEventListener('mouseup', stopVolumeDrag);
          } else {
            // Just a click
            setVolumePercent(percent);
          }
        });
        
        function handleVolumeDrag(e) {
          const volumeBarRect = volumeBar.getBoundingClientRect();
          let percent = (e.clientX - volumeBarRect.left) / volumeBarRect.width;
          percent = Math.max(0, Math.min(1, percent));
          
          setVolumePercent(percent);
        }
        
        function stopVolumeDrag() {
          isDraggingVolume = false;
          document.removeEventListener('mousemove', handleVolumeDrag);
          document.removeEventListener('mouseup', stopVolumeDrag);
        }
        
        function setVolumePercent(percent) {
          audioPlayer.volume = percent;
          volumeProgress.style.width = `${percent * 100}%`;
          volumeHandle.style.right = `${100 - (percent * 100)}%`;
          
          // Update volume icon
          const volumeIcon = document.getElementById('volume-icon');
          if (percent === 0) {
            volumeIcon.className = 'fas fa-volume-mute';
          } else if (percent < 0.5) {
            volumeIcon.className = 'fas fa-volume-down';
          } else {
            volumeIcon.className = 'fas fa-volume-up';
          }
        }
        
        // Toggle mute on volume icon click
        document.getElementById('volume-icon').addEventListener('click', function() {
          if (audioPlayer.volume > 0) {
            // Store the current volume for unmuting
            audioPlayer.dataset.prevVolume = audioPlayer.volume;
            setVolumePercent(0);
          } else {
            // Restore previous volume or set to 70% if not stored
            const prevVolume = parseFloat(audioPlayer.dataset.prevVolume) || 0.7;
            setVolumePercent(prevVolume);
          }
        });
        
        // Handle song end
        audioPlayer.addEventListener('ended', function() {
          isPlaying = false;
          updatePlayButton();
        });
        
        // Forward and backward buttons
        document.querySelector('.fa-step-forward').addEventListener('click', function() {
          if (!currentSong || !audioPlayer.duration) return;
          audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10);
        });
        
        document.querySelector('.fa-step-backward').addEventListener('click', function() {
          if (!currentSong) return;
          audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10);
        });
        // Function to show North Korean error dialog
        function showErrorDialog() {
          const overlay = document.createElement('div');
          overlay.className = 'error-overlay';
          
          const dialog = document.createElement('div');
          dialog.className = 'error-dialog';
          
          // Title bar
          const titleBar = document.createElement('div');
          titleBar.className = 'error-title-bar';
          titleBar.innerHTML = '<span>DPRK System Error</span><span class="close-btn">Ã—</span>';
          
          // Content
          const content = document.createElement('div');
          content.className = 'error-content';
          
          // Flag image
          const flagImg = document.createElement('img');
          flagImg.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Flag_of_North_Korea.svg/800px-Flag_of_North_Korea.svg.png';
          flagImg.alt = 'North Korea Flag';
          
          // Error message
          const message = document.createElement('div');
          message.className = 'error-message';
          message.innerHTML = `
            <b>CRITICAL ERROR #9458</b><br><br>
            You have attempted to access forbidden South Korean cultural material.<br><br>
            This violation of the Democratic People's Republic of Korea's laws has been recorded.<br><br>
            Your IP address and location have been forwarded to authorities.<br><br>
            <b>Penalty:</b> Re-education through labor (3-5 years)
          `;
          
          content.appendChild(flagImg);
          content.appendChild(message);
          
          // Buttons
          const buttons = document.createElement('div');
          buttons.className = 'error-buttons';
          
          const okButton = document.createElement('button');
          okButton.className = 'error-button';
          okButton.textContent = 'Accept Punishment';
          
          buttons.appendChild(okButton);
          
          // Assemble dialog
          dialog.appendChild(titleBar);
          dialog.appendChild(content);
          dialog.appendChild(buttons);
          
          overlay.appendChild(dialog);
          document.body.appendChild(overlay);
          
          // Event listeners
          titleBar.querySelector('.close-btn').addEventListener('click', function() {
            document.body.removeChild(overlay);
          });
          
          okButton.addEventListener('click', function() {
            document.body.removeChild(overlay);
          });
        }

        // Liked songs functionality
        function getLikedSongs() {
          const likedSongs = localStorage.getItem(LIKED_SONGS_KEY);
          return likedSongs ? JSON.parse(likedSongs) : [];
        }
        
        function saveLikedSongs(likedSongs) {
          localStorage.setItem(LIKED_SONGS_KEY, JSON.stringify(likedSongs));
        }
        
        function isSongLiked(songId) {
          const likedSongs = getLikedSongs();
          return likedSongs.includes(songId);
        }
        
        function toggleLikeSong() {
          if (!currentSong) return;
          
          const songId = currentSong.id;
          const likedSongs = getLikedSongs();
          
          if (isSongLiked(songId)) {
            // Unlike the song
            const index = likedSongs.indexOf(songId);
            if (index !== -1) {
              likedSongs.splice(index, 1);
            }
          } else {
            // Like the song
            likedSongs.push(songId);
          }
          
          saveLikedSongs(likedSongs);
          updateLikeButton();
          
          // If we're in the liked songs view, refresh it
          if (document.getElementById('liked-songs-view').style.display !== 'none') {
            loadLikedSongs();
          }
        }
        
        function updateLikeButton() {
          if (!currentSong) return;
          
          const likeBtn = document.getElementById('current-song-like');
          
          if (isSongLiked(currentSong.id)) {
            likeBtn.classList.add('active');
          } else {
            likeBtn.classList.remove('active');
          }
        }
        
        function loadLikedSongs() {
          const likedSongsContainer = document.getElementById('liked-songs-container');
          const emptyMessage = document.getElementById('liked-songs-empty');
          
          const likedSongIds = getLikedSongs();
          
          if (likedSongIds.length === 0) {
            likedSongsContainer.innerHTML = '';
            emptyMessage.style.display = 'block';
            return;
          }
          
          // Get the song objects
          const likedSongs = likedSongIds.map(id => songs.find(s => s.id === id)).filter(Boolean);
          
          emptyMessage.style.display = 'none';
          
          likedSongsContainer.innerHTML = `
            <table class="playlist-songs">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                ${likedSongs.map((song, index) => `
                  <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                    <td class="song-number">${index + 1}</td>
                    <td>
                      <div class="song-cell">
                        <div class="song-cell-img">
                          <img src="images/${song.imageFile}" alt="${song.title}">
                        </div>
                        <div class="song-cell-info">
                          <div class="song-cell-title">${song.title}</div>
                          <div class="song-cell-artist">${song.artist}</div>
                        </div>
                      </div>
                    </td>
                    <td>3:45</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
        
        // Recently played functionality
        function getRecentlyPlayed() {
          const recentlyPlayed = localStorage.getItem(RECENTLY_PLAYED_KEY);
          return recentlyPlayed ? JSON.parse(recentlyPlayed) : [];
        }
        
        function saveRecentlyPlayed(recentlyPlayed) {
          localStorage.setItem(RECENTLY_PLAYED_KEY, JSON.stringify(recentlyPlayed));
        }
        
        function addToRecentlyPlayed(songId) {
          const recentlyPlayed = getRecentlyPlayed();
          
          // Remove if already in the list
          const index = recentlyPlayed.indexOf(songId);
          if (index !== -1) {
            recentlyPlayed.splice(index, 1);
          }
          
          // Add to the beginning
          recentlyPlayed.unshift(songId);
          
          // Keep only the last 20 songs
          if (recentlyPlayed.length > 20) {
            recentlyPlayed.pop();
          }
          
          saveRecentlyPlayed(recentlyPlayed);
        }
        
        function loadRecentlyPlayed() {
          const recentlyPlayedContainer = document.getElementById('recently-played-container');
          const emptyMessage = document.getElementById('recently-played-empty');
          
          const recentlyPlayedIds = getRecentlyPlayed();
          
          if (recentlyPlayedIds.length === 0) {
            recentlyPlayedContainer.innerHTML = '';
            emptyMessage.style.display = 'block';
            return;
          }
          
          // Get the song objects
          const recentSongs = recentlyPlayedIds.map(id => songs.find(s => s.id === id)).filter(Boolean);
          
          emptyMessage.style.display = 'none';
          
          recentlyPlayedContainer.innerHTML = `
            <table class="playlist-songs">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                ${recentSongs.map((song, index) => `
                  <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                    <td class="song-number">${index + 1}</td>
                    <td>
                      <div class="song-cell">
                        <div class="song-cell-img">
                          <img src="images/${song.imageFile}" alt="${song.title}">
                        </div>
                        <div class="song-cell-info">
                          <div class="song-cell-title">${song.title}</div>
                          <div class="song-cell-artist">${song.artist}</div>
                        </div>
                      </div>
                    </td>
                    <td>3:45</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
        // Function to show the add playlist modal
        function showAddPlaylistModal() {
          const overlay = document.createElement('div');
          overlay.className = 'modal-overlay';
          
          const content = document.createElement('div');
          content.className = 'modal-content';
          
          // Create song images for selection instead of checkboxes
          const songSelectionGrid = songs
            .filter(song => song.id !== 'song8') // Filter out BTS song
            .map(song => `
              <div class="song-selection-tile" data-song-id="${song.id}">
                <img src="images/${song.imageFile}" alt="${song.title}" class="song-selection-img">
                <div class="song-selection-title">${song.title}</div>
                <div class="song-selection-overlay"></div>
              </div>
            `).join('');
          
          content.innerHTML = `
            <div class="modal-header">
              <h2>Create Playlist</h2>
            </div>
            
            <div class="modal-form">
              <div class="modal-form-group">
                <label for="playlist-name">Playlist Name</label>
                <input type="text" id="playlist-name" placeholder="My Kim Playlist">
              </div>
              
              <div class="modal-form-group">
                <label for="playlist-description">Description</label>
                <textarea id="playlist-description" placeholder="Add an optional description"></textarea>
              </div>
              
              <div class="modal-form-group">
                <label>Cover Image</label>
                <input type="file" id="cover-upload" accept="image/*">
                <div class="image-preview" id="cover-preview">
                  <span>No image selected</span>
                </div>
              </div>
              
              <div class="modal-form-group">
                <label>Select Songs (At least one)</label>
                <div class="song-selection-grid">
                  ${songSelectionGrid}
                </div>
              </div>
            </div>
            
            <div class="modal-footer">
              <button class="modal-btn modal-btn-cancel" id="cancel-playlist">Cancel</button>
              <button class="modal-btn modal-btn-primary" id="create-playlist">Create</button>
            </div>
          `;

          // Add styles for the song selection grid
          const styleElement = document.createElement('style');
          styleElement.textContent = `
            .song-selection-grid {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 12px;
              max-height: 300px;
              overflow-y: auto;
              padding: 10px;
              background-color: #333;
              border-radius: 4px;
            }
            
            .song-selection-tile {
              position: relative;
              cursor: pointer;
              border-radius: 6px;
              overflow: hidden;
              transition: transform 0.2s;
              aspect-ratio: 1;
            }
            
            .song-selection-tile:hover {
              transform: scale(1.05);
            }
            
            .song-selection-tile img {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }
            
            .song-selection-title {
              position: absolute;
              bottom: 0;
              left: 0;
              right: 0;
              background: rgba(0, 0, 0, 0.7);
              color: white;
              padding: 5px;
              font-size: 12px;
              text-align: center;
            }
            
            .song-selection-overlay {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: rgba(29, 185, 84, 0.6);
              display: flex;
              align-items: center;
              justify-content: center;
              opacity: 0;
              transition: opacity 0.2s;
            }
            
            .song-selection-overlay::after {
              content: 'âœ“';
              font-size: 32px;
              color: white;
              font-weight: bold;
            }
            
            .song-selection-tile.selected .song-selection-overlay {
              opacity: 1;
            }
          `;
          document.head.appendChild(styleElement);
          
          overlay.appendChild(content);
          document.body.appendChild(overlay);
          
          // Setup song selection by clicking on images
          const songTiles = content.querySelectorAll('.song-selection-tile');
          songTiles.forEach(tile => {
            tile.addEventListener('click', function() {
              this.classList.toggle('selected');
            });
          });
          
          // Setup image uploader and preview
          const fileInput = content.querySelector('#cover-upload');
          const imagePreview = content.querySelector('#cover-preview');
          let uploadedImage = null;
          
          fileInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
              uploadedImage = file;
              
              // Preview the image
              const reader = new FileReader();
              reader.onload = function(e) {
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Uploaded cover">`;
              };
              reader.readAsDataURL(file);
            }
          });
          
          // Cancel button
          content.querySelector('#cancel-playlist').addEventListener('click', function() {
            document.body.removeChild(overlay);
          });
          
          // Create button
          content.querySelector('#create-playlist').addEventListener('click', async function() {
            const name = content.querySelector('#playlist-name').value.trim();
            const description = content.querySelector('#playlist-description').value.trim();
            
            // Validation
            if (!name) {
              alert('Please enter a playlist name');
              return;
            }
            
            if (!uploadedImage) {
              alert('Please upload a cover image');
              return;
            }
            
            // Get selected songs
            const selectedSongs = Array.from(content.querySelectorAll('.song-selection-tile.selected'))
              .map(tile => tile.dataset.songId);
            
            if (selectedSongs.length === 0) {
              alert('Please select at least one song');
              return;
            }
            
            // Show loading state
            const createBtn = content.querySelector('#create-playlist');
            const originalBtnText = createBtn.textContent;
            createBtn.textContent = 'Creating...';
            createBtn.disabled = true;
            
            try {
              // 1. Upload the image to Supabase Storage
              const filename = `playlist-cover-${Date.now()}-${uploadedImage.name.replace(/[^a-zA-Z0-9.-]/g, '_')}`;
              
              const { data: uploadData, error: uploadError } = await supabase
                .storage
                .from('playlist-covers')
                .upload(filename, uploadedImage);
              
              if (uploadError) throw uploadError;
              
              // 2. Get the public URL for the uploaded image
              const { data: { publicUrl } } = supabase
                .storage
                .from('playlist-covers')
                .getPublicUrl(filename);
              
              // 3. Create a new playlist record
              const playlistData = {
                name: name,
                description: description || 'No description',
                image_url: publicUrl,
                songs: selectedSongs,
                is_user_created: true,
                created_at: new Date().toISOString()
              };
              
              const { data: playlist, error: insertError } = await supabase
                .from('playlists')
                .insert(playlistData)
                .select()
                .single();
              
              if (insertError) throw insertError;
              
              // 4. Reload playlists
              await loadPlaylists();
              
              // 5. Close the modal
              document.body.removeChild(overlay);
              
              // 6. Show the new playlist
              loadPlaylistView(playlist.id);
              
            } catch (error) {
              console.error('Error creating playlist:', error);
              alert('An error occurred while creating the playlist. Please try again.');
              
              // Reset button state
              createBtn.textContent = originalBtnText;
              createBtn.disabled = false;
            }
          });
        }

        // Function to animate the stats when viewing the wrapped
        function animateWrappedStats() {
          const statNumbers = document.querySelectorAll('.stat-number');
          
          statNumbers.forEach(statElement => {
            const targetValue = parseInt(statElement.textContent);
            
            // Reset to zero
            statElement.textContent = '0';
            
            // Animate to target value
            let currentValue = 0;
            const duration = 2000; // 2 seconds
            const interval = 16; // ~60fps
            const steps = duration / interval;
            const increment = targetValue / steps;
            
            const counter = setInterval(() => {
              currentValue += increment;
              
              if (currentValue >= targetValue) {
                statElement.textContent = targetValue;
                clearInterval(counter);
              } else {
                statElement.textContent = Math.floor(currentValue);
              }
            }, interval);
          });
        }

        function addMemeNavLink() {
    // Check if the link already exists first
    if (document.getElementById('meme-link')) {
        return; // Stop here if the link already exists
    }
  
    const nav = document.querySelector('nav');
    const mapLink = document.getElementById('map-link');
    
    // Create meme generator link element
    const memeLink = document.createElement('a');
    memeLink.href = "#";
    memeLink.className = "nav-link";
    memeLink.id = "meme-link";
    memeLink.innerHTML = `
      <span class="icon"><i class="fas fa-image"></i></span>
      <span>Meme Generator</span>
    `;
    
    // Check if map link exists, and insert after it or after wrapped link
    if (mapLink) {
      nav.insertBefore(memeLink, mapLink.nextSibling);
    } else {
      const wrappedLink = document.getElementById('wrapped-link');
      nav.insertBefore(memeLink, wrappedLink.nextSibling);
    }
    
    // Add event listener for meme link
    memeLink.addEventListener('click', function() {
      showMemeModal();
    });
}

// Function to show the meme generator modal
function showMemeModal() {
  document.getElementById('meme-modal').style.display = 'flex';
  initMemeGenerator();
}

// Function to close the meme generator modal
function closeMemeModal() {
  document.getElementById('meme-modal').style.display = 'none';
}

// Meme generator initialization
function initMemeGenerator() {
  // Select elements
  const templateItems = document.querySelectorAll('.template-item');
  const topTextInput = document.getElementById('top-text');
  const bottomTextInput = document.getElementById('bottom-text');
  const colorButtons = document.querySelectorAll('.color-btn');
  const strokeButtons = document.querySelectorAll('.stroke-btn');
  const bgButtons = document.querySelectorAll('.bg-btn');
  const generateBtn = document.getElementById('generate-meme');
  const downloadBtn = document.getElementById('download-meme');
  const shareBtn = document.getElementById('share-meme');
  const memeCanvas = document.getElementById('meme-canvas');
  const previewMessage = document.querySelector('.preview-message');
  
  // Skip if already initialized
  if (window.memeGeneratorInitialized) return;
  window.memeGeneratorInitialized = true;
  
  let selectedTemplate = null;
  let selectedColor = '#ffffff';
  let selectedStroke = 'thin';
  let selectedBg = 'none';
  
  // Set default selections
  colorButtons[0].classList.add('selected');
  strokeButtons[1].classList.add('selected');
  bgButtons[0].classList.add('selected');
  
  // Template selection
  templateItems.forEach(item => {
    item.addEventListener('click', function() {
      templateItems.forEach(t => t.classList.remove('selected'));
      this.classList.add('selected');
      selectedTemplate = this.getAttribute('data-template');
    });
  });
  
  // Color selection
  colorButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      colorButtons.forEach(b => b.classList.remove('selected'));
      this.classList.add('selected');
      selectedColor = this.getAttribute('data-color');
    });
  });
  
  // Stroke selection
  strokeButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      strokeButtons.forEach(b => b.classList.remove('selected'));
      this.classList.add('selected');
      selectedStroke = this.getAttribute('data-stroke');
    });
  });
  
  // Background selection
  bgButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      bgButtons.forEach(b => b.classList.remove('selected'));
      this.classList.add('selected');
      selectedBg = this.getAttribute('data-bg');
    });
  });
  
  // Generate meme button
  generateBtn.addEventListener('click', function() {
    if (!selectedTemplate) {
      alert('Please select a template image first.');
      return;
    }
    
    generateMeme();
  });
  
  // Download button
  downloadBtn.addEventListener('click', function() {
    downloadMeme();
  });
  
  // Share button
  shareBtn.addEventListener('click', function() {
    // Show error dialog when sharing
    showErrorDialog();
  });
  
  // Function to generate the meme
  function generateMeme() {
    const ctx = memeCanvas.getContext('2d');
    ctx.clearRect(0, 0, memeCanvas.width, memeCanvas.height);
    
    // Load the template image
    const img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function() {
      // Set background based on selection
      if (selectedBg === 'none') {
        ctx.drawImage(img, 0, 0, memeCanvas.width, memeCanvas.height);
      } else if (selectedBg === 'red') {
        ctx.fillStyle = '#c00000';
        ctx.fillRect(0, 0, memeCanvas.width, memeCanvas.height);
        ctx.drawImage(img, 40, 40, memeCanvas.width - 80, memeCanvas.height - 80);
      } else if (selectedBg === 'stars') {
        // Draw stars background
        ctx.fillStyle = '#00205b';
        ctx.fillRect(0, 0, memeCanvas.width, memeCanvas.height);
        
        // Draw stars
        ctx.fillStyle = 'white';
        for (let i = 0; i < 50; i++) {
          const x = Math.random() * memeCanvas.width;
          const y = Math.random() * memeCanvas.height;
          const size = Math.random() * 3 + 1;
          ctx.beginPath();
          ctx.arc(x, y, size, 0, Math.PI * 2);
          ctx.fill();
        }
        
        ctx.drawImage(img, 40, 40, memeCanvas.width - 80, memeCanvas.height - 80);
      }
      
      // Set font style
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      
      // Determine font size based on text length
      const topText = topTextInput.value.toUpperCase() || 'ADD TOP TEXT';
      const bottomText = bottomTextInput.value.toUpperCase() || 'ADD BOTTOM TEXT';
      
      const fontSize = Math.min(50, 400 / Math.max(topText.length, bottomText.length) * 5);
      ctx.font = `bold ${fontSize}px Impact, Arial, sans-serif`;
      
      // Set text color
      ctx.fillStyle = selectedColor;
      
      // Add text stroke based on selection
      if (selectedStroke !== 'none') {
        ctx.lineWidth = selectedStroke === 'thin' ? 2 : 4;
        ctx.strokeStyle = 'black';
      }
      
      // Draw top text
      if (selectedStroke !== 'none') {
        ctx.strokeText(topText, memeCanvas.width / 2, 15, memeCanvas.width - 15);
      }
      ctx.fillText(topText, memeCanvas.width / 2, 15, memeCanvas.width - 15);
      
      // Draw bottom text
      if (selectedStroke !== 'none') {
        ctx.strokeText(bottomText, memeCanvas.width / 2, memeCanvas.height - fontSize - 15, memeCanvas.width - 15);
      }
      ctx.fillText(bottomText, memeCanvas.width / 2, memeCanvas.height - fontSize - 15, memeCanvas.width - 15);
      
      // Show canvas and hide message
      memeCanvas.style.display = 'block';
      previewMessage.style.display = 'none';
      
      // Enable download and share buttons
      downloadBtn.disabled = false;
      shareBtn.disabled = false;
      
      // Add to recent memes
      addToRecentMemes();
    };
    
    // Set image source based on template selection
    // In a real implementation, you would have different image URLs for each template
    img.src = document.querySelector(`.template-item[data-template="${selectedTemplate}"] img`).src;
  }
  
  // Function to download the meme
  function downloadMeme() {
    const link = document.createElement('a');
    link.download = 'kimify-meme.png';
    link.href = memeCanvas.toDataURL('image/png');
    link.click();
  }
  
  // Function to add meme to recent memes section
  function addToRecentMemes() {
    const recentMemesContainer = document.getElementById('recent-memes-container');
    const emptyMessage = recentMemesContainer.querySelector('.empty-memes-message');
    
    // Remove empty message if it exists
    if (emptyMessage) {
      emptyMessage.remove();
    }
    
    // Create meme item
    const memeItem = document.createElement('div');
    memeItem.className = 'recent-meme-item';
    
    // Create image element
    const img = document.createElement('img');
    img.src = memeCanvas.toDataURL('image/png');
    memeItem.appendChild(img);
    
    // Add click event to show the meme in the canvas
    memeItem.addEventListener('click', function() {
      const tempImg = new Image();
      tempImg.src = img.src;
      tempImg.onload = function() {
        const ctx = memeCanvas.getContext('2d');
        ctx.clearRect(0, 0, memeCanvas.width, memeCanvas.height);
        ctx.drawImage(tempImg, 0, 0, memeCanvas.width, memeCanvas.height);
        
        memeCanvas.style.display = 'block';
        previewMessage.style.display = 'none';
        
        downloadBtn.disabled = false;
        shareBtn.disabled = false;
      };
    });
    
    // Add to container (at the beginning)
    if (recentMemesContainer.firstChild) {
      recentMemesContainer.insertBefore(memeItem, recentMemesContainer.firstChild);
    } else {
      recentMemesContainer.appendChild(memeItem);
    }
    
    // Limit to 8 recent memes
    const items = recentMemesContainer.querySelectorAll('.recent-meme-item');
    if (items.length > 8) {
      recentMemesContainer.removeChild(items[items.length - 1]);
    }
  }
}

function addMapNavLink() {
    // Check if the link already exists first
    if (document.getElementById('map-link')) {
        return; // Stop here if the link already exists
    }
    
    const nav = document.querySelector('nav');
    const wrappedLink = document.getElementById('wrapped-link');
    
    // Create map link element
    const mapLink = document.createElement('a');
    mapLink.href = "#";
    mapLink.className = "nav-link";
    mapLink.id = "map-link";
    mapLink.innerHTML = `
      <span class="icon"><i class="fas fa-map-marked-alt"></i></span>
      <span>Live Listeners</span>
    `;
    
    // Insert after wrapped link
    nav.insertBefore(mapLink, wrappedLink.nextSibling);
    
    // Add event listener
    mapLink.addEventListener('click', function() {
      showMapModal();
    });
}
  
  // Function to show the map modal
  function showMapModal() {
    document.getElementById('map-modal').style.display = 'flex';
    initializeMap();
  }
  
  // Function to close the map modal
  function closeMapModal() {
    document.getElementById('map-modal').style.display = 'none';
    stopMapUpdates();
  }
  
  // Map initialization and updates
  let updateInterval;
  let cityElements;
  
  function initializeMap() {
  // Clear previous interval if exists
  if (updateInterval) {
    clearInterval(updateInterval);
  }
  
  // Get all city markers
  cityElements = document.querySelectorAll('.city-marker');
  
  // Add event listeners to cities
  cityElements.forEach(city => {
    city.addEventListener('mouseenter', showTooltip);
    city.addEventListener('mouseleave', hideTooltip);
  });
  
  // Add pulse animation to random cities
  addRandomPulse();
  
  // Start updates for live listeners count
  updateListenerCount();
  
  // Add live updates to the feed
  startLiveUpdates();
}
  
function showTooltip(e) {
  const city = e.target;
  const tooltip = document.getElementById('map-tooltip');
  
  // Get city data
  const cityName = city.getAttribute('data-city');
  const listeners = city.getAttribute('data-listeners');
  
  // Update tooltip content
  tooltip.querySelector('.tooltip-city').textContent = cityName;
  tooltip.querySelector('.tooltip-listeners').textContent = `${listeners} listeners`;
  
  // Get position
  const rect = city.getBoundingClientRect();
  const mapContainer = document.getElementById('north-korea-map-container');
  const mapRect = mapContainer.getBoundingClientRect();
  
  // Position tooltip above the city
  tooltip.style.left = `${rect.left - mapRect.left + rect.width / 2}px`;
  tooltip.style.top = `${rect.top - mapRect.top - tooltip.offsetHeight - 10}px`;
  
  // Show tooltip
  tooltip.style.display = 'block';
}
  
  function hideTooltip() {
    document.getElementById('map-tooltip').style.display = 'none';
  }
  
  function addRandomPulse() {
  // Remove existing pulse animations
  cityElements.forEach(city => {
    city.classList.remove('pulse');
  });
  
  // Add pulse to 1-3 random cities
  const numPulses = Math.floor(Math.random() * 3) + 1;
  const cities = Array.from(cityElements);
  
  for (let i = 0; i < numPulses; i++) {
    if (cities.length > 0) {
      const randomIndex = Math.floor(Math.random() * cities.length);
      cities[randomIndex].classList.add('pulse');
      cities.splice(randomIndex, 1);
    }
  }
}
  
  function updateListenerCount() {
    let totalListeners = 0;
    
    // Calculate total listeners
    cityElements.forEach(city => {
      totalListeners += parseInt(city.getAttribute('data-listeners'));
    });
    
    // Update display
    document.getElementById('online-listeners').textContent = totalListeners.toLocaleString();
    
    // Randomly adjust city listeners
    updateInterval = setInterval(() => {
      let changesMade = false;
      
      cityElements.forEach(city => {
        // 20% chance to update each city
        if (Math.random() < 0.2) {
          changesMade = true;
          let listeners = parseInt(city.getAttribute('data-listeners'));
          
          // Random change between -5 and +10
          const change = Math.floor(Math.random() * 16) - 5;
          listeners = Math.max(10, listeners + change);
          
          city.setAttribute('data-listeners', listeners);
          
          // Update tooltip if visible
          const tooltip = document.getElementById('map-tooltip');
          if (tooltip.style.display === 'block') {
            const cityName = tooltip.querySelector('.tooltip-city').textContent;
            if (cityName === city.getAttribute('data-city')) {
              tooltip.querySelector('.tooltip-listeners').textContent = `${listeners} listeners`;
            }
          }
        }
      });
      
      if (changesMade) {
        // Recalculate total
        let newTotal = 0;
        cityElements.forEach(city => {
          newTotal += parseInt(city.getAttribute('data-listeners'));
        });
        
        // Update display with animation
        animateNumber(document.getElementById('online-listeners'), newTotal);
        
        // Occasionally change pulse animation
        if (Math.random() < 0.3) {
          addRandomPulse();
        }
      }
    }, 5000);
  }
  
  function animateNumber(element, newValue) {
    const oldValue = parseInt(element.textContent.replace(/,/g, ''));
    const difference = newValue - oldValue;
    const steps = 20;
    const increment = difference / steps;
    let currentStep = 0;
    
    const updateFn = () => {
      currentStep++;
      const currentValue = Math.round(oldValue + increment * currentStep);
      element.textContent = currentValue.toLocaleString();
      
      if (currentStep < steps) {
        requestAnimationFrame(updateFn);
      }
    };
    
    requestAnimationFrame(updateFn);
  }
  
  function startLiveUpdates() {
    const updates = document.getElementById('live-updates');
    const songs = [
      "Death to America (Dance Remix)",
      "Miss You Ye (Rocket Man)",
      "My Nuclear Button Is Bigger",
      "Internet? Never Heard of It",
      "Kim Style",
      "Sad Kimmy",
      "gym flow",
      "firework",
      "Hasnt started yet",
      "rapstuff"
    ];
    
    const actions = [
      "is listening to",
      "added to playlist",
      "liked",
      "shared with the State Security Department",
      "downloaded for offline listening in bunker",
      "played 10 times today"
    ];
    
    // Add new updates occasionally
    setInterval(() => {
      // Get random city
      const randomCityIndex = Math.floor(Math.random() * cityElements.length);
      const randomCity = cityElements[randomCityIndex].getAttribute('data-city');
      
      // Get random song and action
      const randomSong = songs[Math.floor(Math.random() * songs.length)];
      const randomAction = actions[Math.floor(Math.random() * actions.length)];
      
      // Create new update item
      const newUpdate = document.createElement('div');
      newUpdate.className = 'update-item';
      
      // Decide between user action or group action
      if (Math.random() < 0.7) {
        newUpdate.textContent = `User in ${randomCity} ${randomAction} "${randomSong}"`;
      } else {
        const userCount = Math.floor(Math.random() * 10) + 2;
        newUpdate.textContent = `${userCount} users in ${randomCity} ${
          ["joined in the last hour", "are currently active", "reported for unauthorized dancing"][Math.floor(Math.random() * 3)]
        }`;
      }
      
      // Add to feed
      updates.insertBefore(newUpdate, updates.firstChild);
      
      // Remove oldest if more than 20
      if (updates.children.length > 20) {
        updates.removeChild(updates.lastChild);
      }
    }, 3000);
  }
    </script>
    <div id="meme-modal" class="modal-overlay" style="display: none;">
        <div class="meme-modal-content">
          <div class="meme-modal-header">
            <h2>Propaganda Meme Generator</h2>
            <button class="meme-close-btn" onclick="closeMemeModal()">Ã—</button>
          </div>
          
          <div class="meme-modal-body">
            <div class="meme-container">
              <div class="meme-editor">
                <div class="editor-section">
                  <h3>1. Select Template</h3>
                  <div class="template-grid">
                    <div class="template-item" data-template="template1">
                      <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0fd42145681d4e63615ea_kim1.png" alt="hasnt started yet">
                    </div>
                    <div class="template-item" data-template="template2">
                      <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0fd9e6b20be04c7d6401e_853444_1.jpg" alt="Supreme Leader">
                    </div>
                    <div class="template-item" data-template="template3">
                      <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0fdbb719e4f764e410a70_kim-jong-un-mutant-cartman-5739eec748aad__700.jpg" alt="Supreme Leader 2">
                    </div>
                    <div class="template-item" data-template="template4">
                      <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0fdf05ebc052abaa5cfb4_hp-op-kimsmoke.webp" alt="Disapproving Supreme Leader">
                    </div>
                  </div>
                </div>
                
                <div class="editor-section">
                  <h3>2. Add Captions</h3>
                  <div class="caption-inputs">
                    <div class="input-group">
                      <label for="top-text">Top Text</label>
                      <input type="text" id="top-text" placeholder="WHEN THEY SAY BTS IS BETTER" maxlength="50">
                    </div>
                    <div class="input-group">
                      <label for="bottom-text">Bottom Text</label>
                      <input type="text" id="bottom-text" placeholder="THAN MY REVOLUTIONARY MIXTAPE" maxlength="50">
                    </div>
                  </div>
                </div>
                
                <div class="editor-section">
                  <h3>3. Customize Style</h3>
                  <div class="style-options">
                    <div class="option-group">
                      <label for="text-color">Text Color</label>
                      <div class="color-buttons">
                        <button class="color-btn" data-color="#ffffff" style="background-color: #ffffff;"></button>
                        <button class="color-btn" data-color="#ff0000" style="background-color: #ff0000;"></button>
                        <button class="color-btn" data-color="#ffff00" style="background-color: #ffff00;"></button>
                        <button class="color-btn" data-color="#00ff00" style="background-color: #00ff00;"></button>
                      </div>
                    </div>
                    <div class="option-group">
                      <label for="text-stroke">Text Outline</label>
                      <div class="stroke-buttons">
                        <button class="stroke-btn" data-stroke="none">None</button>
                        <button class="stroke-btn" data-stroke="thin">Thin</button>
                        <button class="stroke-btn" data-stroke="thick">Thick</button>
                      </div>
                    </div>
                    <div class="option-group">
                      <label for="background">Background</label>
                      <div class="background-buttons">
                        <button class="bg-btn" data-bg="none">None</button>
                        <button class="bg-btn" data-bg="red">Red</button>
                        <button class="bg-btn" data-bg="stars">Stars</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="meme-preview">
                <div class="preview-container">
                  <div class="meme-canvas-container">
                    <canvas id="meme-canvas" width="400" height="400"></canvas>
                  </div>
                  <div class="preview-message">Your meme will appear here</div>
                </div>
                <div class="preview-actions">
                  <button id="generate-meme" class="action-btn generate-btn">Generate Meme</button>
                  <button id="download-meme" class="action-btn download-btn" disabled>Download</button>
                  <button id="share-meme" class="action-btn share-btn" disabled>Share</button>
                </div>
                <div class="approval-notice">
                  <i class="fas fa-shield-alt"></i>
                  <span>Pre-approved by Ministry of Acceptable Internet Content</span>
                </div>
              </div>
            </div>
            
            <div class="recent-memes">
              <h3>Recently Created Propaganda</h3>
              <div class="recent-memes-grid" id="recent-memes-container">
                <!-- Recently created memes will appear here -->
                <div class="empty-memes-message">Your creations will appear here</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="map-modal" class="modal-overlay" style="display: none;">
        <div class="map-modal-content">
          <div class="map-modal-header">
            <h2>Kimify Live Listeners</h2>
            <button class="map-close-btn" onclick="closeMapModal()">Ã—</button>
          </div>
          
          <div class="map-modal-body">
            <div class="map-stats">
              <div class="stats-item">
                <div class="stats-number" id="online-listeners">2,483</div>
                <div class="stats-label">Online Listeners</div>
              </div>
              <div class="stats-item">
                <div class="stats-number" id="average-happiness">0%</div>
                <div class="stats-label">Average Happiness</div>
              </div>
              <div class="stats-item">
                <div class="stats-number" id="government-approval">100%</div>
                <div class="stats-label">Government Approval</div>
              </div>
            </div>
            
            <div class="map-container">
              <div class="map-overlay-text">Democratic People's Republic of Korea</div>
              <div id="north-korea-map-container">
                <!-- Background image approach -->
                <div class="nk-map-image-container">
                  <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0fadc771553c52d334016_kp-03%20(1).png" alt="North Korea Map" class="nk-map-image">
                  
                  <!-- City markers with adjusted positions to stay within the map -->
                  <div class="city-marker" data-city="Pyongyang" data-listeners="1245" style="left: 42%; top: 48%"></div>
                  <div class="city-marker" data-city="Hamhung" data-listeners="367" style="left: 60%; top: 38%"></div>
                  <div class="city-marker" data-city="Nampo" data-listeners="234" style="left: 35%; top: 52%"></div>
                  <div class="city-marker" data-city="Wonsan" data-listeners="301" style="left: 56%; top: 46%"></div>
                  <div class="city-marker" data-city="Chongjin" data-listeners="189" style="left: 63%; top: 25%"></div>
                  <div class="city-marker" data-city="Sinuiju" data-listeners="147" style="left: 60%; top: 38%"></div>
                  <div class="city-marker" data-city="Kaesong" data-listeners="213" style="left: 44%; top: 62%"></div>
                </div>
                
                <!-- Tooltip remains the same -->
                <div id="map-tooltip" class="map-tooltip" style="display: none;">
                  <div class="tooltip-city">City Name</div>
                  <div class="tooltip-listeners">0 listeners</div>
                </div>
                
              </div>
            </div>
            
            <div class="map-footer">
              <div class="map-legend">
                <div class="legend-item">
                  <div class="legend-circle"></div>
                  <div class="legend-text">Active Listener Locations</div>
                </div>
                <div class="legend-item">
                  <div class="legend-line"></div>
                  <div class="legend-text">Border with Imperialist Nations</div>
                </div>
              </div>
              
              <div class="realtime-updates">
                <div class="update-title">Live Updates</div>
                <div class="update-feed" id="live-updates">
                  <div class="update-item">User in Pyongyang is listening to "Death to America (Dance Remix)"</div>
                  <div class="update-item">User in Wonsan added "Miss You Ye (Rocket Man)" to playlist</div>
                  <div class="update-item">3 users in Hamhung joined in the last hour</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
</body>
</html>
