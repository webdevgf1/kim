<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kimify - Kim Jong Un Remixes</title>
  <!-- Favicon -->
  <link rel="icon" href="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09ec69edb8dc3456829f1_kimmy.png" type="image/png">
  <!-- Updated Firebase scripts with compatibility version -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <style>
    /* Font imports */
    @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-family: 'Varela Round', sans-serif;
    }
    
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .sidebar {
      width: 240px;
      background-color: #181818;
      padding: 24px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #333;
    }
    
    .logo {
      display: flex;
      align-items: center;
      margin-bottom: 32px;
    }
    
    .logo-img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 8px;
      object-fit: cover;
    }
    
    .logo span {
      font-size: 24px;
      font-weight: bold;
    }
    
    .nav-link {
      display: flex;
      align-items: center;
      color: #b3b3b3;
      text-decoration: none;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    .nav-link:hover {
      color: #fff;
    }
    
    .nav-link i {
      margin-right: 16px;
      font-size: 20px;
    }
    
    .create-playlist {
      background-color: #121212;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .create-playlist h3 {
      margin-bottom: 8px;
    }
    
    .create-playlist p {
      font-size: 13px;
      color: #b3b3b3;
      margin-bottom: 12px;
    }
    
    .input-group {
      display: flex;
    }
    
    .input-group input {
      flex: 1;
      background-color: #333;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px 0 0 4px;
      font-size: 14px;
    }
    
    .input-group button {
      background-color: #444;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 14px;
    }
    
    .social-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
    }
    
    .social-link {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .social-link:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    
    .playlists-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      margin-top: 24px;
      text-transform: uppercase;
      font-size: 12px;
      color: #b3b3b3;
      font-weight: bold;
    }
    
    .playlists-header i {
      cursor: pointer;
      font-size: 16px;
      width: 24px;
      height: 24px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .playlists-header i:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .playlists-list {
      list-style: none;
      overflow-y: auto;
      max-height: 300px;
    }
    
    .playlists-list li {
      color: #b3b3b3;
      margin-bottom: 8px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 6px 0;
    }
    
    .playlists-list li:hover {
      color: #fff;
    }
    
    .playlist-mini-img {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      margin-right: 10px;
      object-fit: cover;
      background-color: #333;
    }
    
    .main-content {
      flex: 1;
      background: linear-gradient(180deg, #5E287D 0%, #121212 100%);
      overflow-y: auto;
      padding: 32px;
    }
    
    /* Apply styles to prevent text selection for all text elements */
    h1, h2, h3, p, div, span, a, li {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .song-img-container {
      width: 100%;
      aspect-ratio: 1;
      margin-bottom: 8px;
      border-radius: 4px;
      overflow: hidden;
      background-color: #282828;
      position: relative;
    }
    
    .song-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .song-card:hover .song-img {
      transform: scale(1.05);
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .header h1 {
      font-size: 28px;
      font-weight: bold;
      font-family: 'Comfortaa', cursive;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .social-links {
      display: flex;
      gap: 10px;
      margin-right: 10px;
    }
    
    .social-link {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
      transform-origin: center;
    }
    
    .social-link:nth-child(1) {
      transform: rotate(-5deg);
    }
    
    .social-link:nth-child(2) {
      transform: rotate(0deg);
    }
    
    .social-link:nth-child(3) {
      transform: rotate(5deg);
    }
    
    .social-link:hover {
      transform: scale(1.15) rotate(0deg);
      z-index: 2;
    }
    
    .social-icon-wrapper {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 5px;
      overflow: hidden;
    }
    
    .social-link:nth-child(1) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 14px;
    }
    
    .social-link:nth-child(2) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 50%;
    }
    
    .social-link:nth-child(3) .social-icon-wrapper {
      background-color: #fff;
      border-radius: 14px;
    }
    
    .social-icon {
      width: 85%;
      height: 85%;
      object-fit: contain;
    }
    
    .songs-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }
    
    @media (max-width: 1200px) {
      .songs-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (max-width: 992px) {
      .songs-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .songs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .song-card {
      background-color: #181818;
      padding: 0;
      border-radius: 8px;
      transition: background-color 0.3s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    .song-card:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: transparent;
      transition: background-color 0.3s;
      pointer-events: none;
      z-index: 1;
    }
    
    .song-card:hover:before {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .song-card img {
      pointer-events: none; /* Prevents image flickering issues */
      -webkit-user-drag: none;
    }
    
    .song-info-container {
      padding: 16px;
    }
    
    .song-title {
      font-weight: bold;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: 'Comfortaa', cursive;
    }
    
    .song-artist {
      font-size: 13px;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .song-img-placeholder {
      width: 100%;
      height: 100%;
      background-color: #282828;
      position: relative;
    }
    
    .song-img-placeholder:after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(80, 80, 80, 0.2) 0%, rgba(40, 40, 40, 0.2) 100%);
    }
    
    .section-title {
      font-size: 22px;
      font-weight: bold;
      margin: 32px 0 24px;
    }
    
    .player {
      height: 90px;
      background-color: #181818;
      border-top: 1px solid #333;
      display: flex;
      align-items: center;
      padding: 0 16px;
      position: relative;
    }
    
    /* Windows 98 Style Error Dialog */
    .error-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .error-dialog {
      width: 400px;
      background-color: #c0c0c0;
      border: 3px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
      color: #000;
      font-family: 'Courier New', monospace;
      padding: 2px;
      position: relative;
    }
    
    .error-title-bar {
      background: linear-gradient(90deg, #000080, #1084d0);
      color: white;
      font-weight: bold;
      padding: 3px 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .error-title-bar .close-btn {
      background-color: #c0c0c0;
      border: 2px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      color: #000;
      width: 16px;
      height: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      cursor: pointer;
    }
    
    .error-content {
      padding: 10px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .error-content img {
      width: 40px;
      height: 40px;
    }
    
    .error-message {
      flex: 1;
      font-size: 12px;
    }
    
    .error-buttons {
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    
    .error-button {
      background-color: #c0c0c0;
      border: 2px solid #ffffff;
      border-right-color: #808080;
      border-bottom-color: #808080;
      color: #000;
      padding: 4px 10px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      cursor: pointer;
    }
    
    .error-button:active {
      border: 2px solid #808080;
      border-right-color: #ffffff;
      border-bottom-color: #ffffff;
    }
    
    .now-playing {
      width: 30%;
      display: flex;
      align-items: center;
    }
    
    .now-playing-img-container {
      width: 56px;
      height: 56px;
      border-radius: 4px;
      overflow: hidden;
      background-color: #333;
      margin-right: 12px;
    }
    
    .now-playing-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .now-playing-img-placeholder {
      width: 100%;
      height: 100%;
      background-color: #333;
      position: relative;
    }
    
    .player-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      width: 40%;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 4px;
    }
    
    .player-timeline-container {
      display: flex;
      align-items: center;
      width: 100%;
      gap: 8px;
    }
    
    .player-timeline {
      flex: 1;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      position: relative;
      cursor: pointer;
      width: 500px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    
    .timeline-progress {
      height: 100%;
      width: 0%;
      background-color: #b3b3b3;
      border-radius: 2px;
      position: relative;
    }
    
    .timeline-handle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 50%;
      right: 0;
      transform: translate(50%, -50%);
      display: none;
      cursor: grab;
    }
    
    .player-timeline:hover {
      height: 6px;
    }
    
    .player-timeline:hover .timeline-progress {
      background-color: #1DB954;
    }
    
    .player-timeline:hover .timeline-handle {
      display: block;
    }
    
    #current-time, #song-duration {
      font-size: 12px;
      color: #b3b3b3;
      min-width: 40px;
    }
    
    .timeline {
      flex: 1;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      position: relative;
    }
    
    .timeline-progress {
      height: 100%;
      width: 30%;
      background-color: #b3b3b3;
      border-radius: 2px;
    }
    
    .control-buttons i {
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
    }
    
    .control-buttons i:hover {
      color: #fff;
    }
    
    .play-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: white;
      border: none;
      color: black;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }
    
    .volume-slider-container {
      position: relative;
      width: 100px;
    }
    
    .volume-bar {
      width: 100%;
      height: 4px;
      background-color: #5e5e5e;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    .volume-progress {
      height: 100%;
      width: 70%;
      background-color: #b3b3b3;
      border-radius: 2px;
      transition: width 0.1s ease;
    }
    
    .volume-handle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 50%;
      right: 30%; /* 100% - 70% (default volume) */
      transform: translate(50%, -50%);
      display: none;
      cursor: grab;
    }
    
    .volume-bar:hover {
      height: 6px;
    }
    
    .volume-bar:hover .volume-progress {
      background-color: #1DB954;
    }
    
    .volume-bar:hover .volume-handle {
      display: block;
    }
    
    .volume-controls {
      width: 30%;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
      justify-content: flex-end;
    }
    
    /* Adding icons */
    .icon {
      margin-right: 12px;
      width: 20px;
      text-align: center;
    }
    
    /* Search container */
    .search-container {
      margin-bottom: 24px;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      padding: 10px 40px 10px 40px;
      background-color: #242424;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 14px;
    }
    
    .search-input:focus {
      outline: none;
      background-color: #333;
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
    }
    
    .clear-search {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      cursor: pointer;
      display: none;
    }
    
    /* Playlist View */
    .playlist-header {
      display: flex;
      margin-bottom: 24px;
    }
    
    .playlist-cover {
      width: 200px;
      height: 200px;
      background-color: #282828;
      margin-right: 24px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .playlist-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .playlist-info {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding-bottom: 16px;
    }
    
    .playlist-type {
      text-transform: uppercase;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .playlist-title {
      font-size: 42px;
      font-weight: bold;
      margin-bottom: 8px;
      font-family: 'Comfortaa', cursive;
    }
    
    .playlist-description {
      font-size: 14px;
      color: #b3b3b3;
      margin-bottom: 16px;
    }
    
    .playlist-meta {
      font-size: 14px;
      color: #b3b3b3;
    }
    
    .playlist-songs {
      width: 100%;
      border-collapse: collapse;
    }
    
    .playlist-songs th {
      text-align: left;
      padding: 8px 16px;
      color: #b3b3b3;
      font-size: 12px;
      font-weight: normal;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .playlist-songs td {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 14px;
    }
    
    .playlist-songs tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .song-number {
      color: #b3b3b3;
      width: 40px;
    }
    
    .song-cell {
      display: flex;
      align-items: center;
    }
    
    .song-cell-img {
      width: 40px;
      height: 40px;
      margin-right: 16px;
      background-color: #333;
    }
    
    .song-cell-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .song-cell-info {
      display: flex;
      flex-direction: column;
    }
    
    .song-cell-title {
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .song-cell-artist {
      font-size: 12px;
      color: #b3b3b3;
    }
    
    /* Like button */
    .like-btn {
      color: #b3b3b3;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s;
      margin-left: 12px;
    }
    
    .like-btn:hover, .like-btn.active {
      color: #1DB954;
      transform: scale(1.1);
    }
    
    .like-btn.active {
      color: #1DB954;
    }
    
    .heart-icon {
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
    }
    
    /* Hide the original heart icon when active */
    .like-btn.active .fa-heart-o {
      display: none;
    }
    
    /* Show the filled heart icon when active */
    .like-btn.active .fa-heart {
      display: inline-block;
    }
    
    /* Hide the filled heart icon by default */
    .fa-heart {
      display: none;
    }
    
    /* Loading spinner */
    .loader {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      width: 400px;
      background-color: #282828;
      border-radius: 8px;
      padding: 24px;
    }
    
    .modal-header {
      margin-bottom: 24px;
    }
    
    .modal-header h2 {
      font-size: 24px;
      font-weight: bold;
    }
    
    .modal-form-group {
      margin-bottom: 16px;
    }
    
    .modal-form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #b3b3b3;
    }
    
    .modal-form-group input, .modal-form-group textarea {
      width: 100%;
      padding: 10px;
      background-color: #333;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 14px;
    }
    
    .modal-form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .modal-form-group input:focus, .modal-form-group textarea:focus {
      outline: none;
      background-color: #3a3a3a;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
      margin-top: 24px;
    }
    
    .modal-btn {
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }

    .modal-btn-cancel {
      background-color: transparent;
      color: white;
    }
    
    .modal-btn-cancel:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .modal-btn-primary {
      background-color: #1DB954;
      color: white;
    }
    
    .modal-btn-primary:hover {
      background-color: #1ed760;
    }
    
    .modal-form-group .image-preview {
      width: 100%;
      height: 120px;
      background-color: #333;
      border-radius: 4px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #b3b3b3;
      position: relative;
      overflow: hidden;
    }
    
    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Image selector */
    .image-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .image-option {
      width: 60px;
      height: 60px;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .image-option.selected {
      border-color: #1DB954;
    }
    
    .image-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #333;
      }
      .player-timeline {
        width: 200px;
      }
    }
  </style>
  <!-- Adding Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="logo">
        <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09ec69edb8dc3456829f1_kimmy.png" alt="Kimify Logo" class="logo-img">
        <span>Kimify</span>
      </div>
      
      <nav>
        <a href="#" class="nav-link" id="home-link">
          <span class="icon"><i class="fas fa-home"></i></span>
          <span>Home</span>
        </a>
        <a href="#" class="nav-link" id="search-link">
          <span class="icon"><i class="fas fa-search"></i></span>
          <span>Search</span>
        </a>
        <a href="#" class="nav-link" id="recently-played-link">
          <span class="icon"><i class="fas fa-history"></i></span>
          <span>Recently Played</span>
        </a>
        <a href="#" class="nav-link" id="liked-songs-link">
          <span class="icon"><i class="fas fa-heart"></i></span>
          <span>Liked Songs</span>
        </a>
      </nav>
      
      <div class="playlists-header">
        <span>PLAYLISTS</span>
        <i class="fas fa-plus" id="add-playlist-btn"></i>
      </div>
      
      <ul class="playlists-list" id="playlists-container">
        <!-- Playlists will be loaded here -->
        <div class="loader"></div>
      </ul>
    </div>
    
    <div class="main-content" id="main-content">
      <!-- Main content will change based on selected view -->
      <div id="home-view">
        <div class="header">
          <h1>Kim's Songs</h1>
          <div class="header-right">
            <div class="social-links">
              <a href="https://twitter.com/kimcoin" target="_blank" class="social-link">
                <div class="social-icon-wrapper">
                  <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e0930241517bce72bf2df2_Logo_of_Twitter.svg.png" alt="Twitter" class="social-icon">
                </div>
              </a>
              <a href="https://discord.com" target="_blank" class="social-link">
                <div class="social-icon-wrapper">
                  <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e09302ce2c79cb6daaebcc_Pump_fun_logo%20(2).png" alt="pump.fun" class="social-icon">
                </div>
              </a>
              <a href="https://dexscreener.com" target="_blank" class="social-link">
                <div class="social-icon-wrapper">
                  <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/67e093028190f33913455b57_dex-screener-seeklogo.png" alt="DexScreener" class="social-icon">
                </div>
              </a>
            </div>
          </div>
        </div>
        
        <div class="songs-grid" id="songs-grid">
          <!-- Song cards will be loaded here -->
        </div>
      </div>

      <div id="search-view" style="display: none;">
        <div class="header">
          <h1>Search</h1>
        </div>
        
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="search-input" placeholder="Search for songs or artists...">
          <i class="fas fa-times clear-search" id="clear-search"></i>
        </div>
        
        <div id="search-results">
          <!-- Search results will appear here -->
          <div class="search-message" id="search-message">
            <p>Start typing to search</p>
          </div>
        </div>
      </div>

      <div id="recently-played-view" style="display: none;">
        <div class="header">
          <h1>Recently Played</h1>
        </div>
        
        <div id="recently-played-container">
          <!-- Recently played songs will appear here -->
          <p class="empty-message" id="recently-played-empty" style="display: none;">
            You haven't played any songs yet.
          </p>
        </div>
      </div>

      <div id="liked-songs-view" style="display: none;">
        <div class="header">
          <h1>Liked Songs</h1>
        </div>
        
        <div id="liked-songs-container">
          <!-- Liked songs will appear here -->
          <p class="empty-message" id="liked-songs-empty" style="display: none;">
            You haven't liked any songs yet.
          </p>
        </div>
      </div>

      <div id="playlist-view" style="display: none;">
        <!-- Playlist view will be populated dynamically -->
      </div>
    </div>
  </div>
  
  <div class="player">
    <div class="now-playing">
      <div class="now-playing-img-container" id="current-song-img-container">
        <div class="now-playing-img-placeholder"></div>
      </div>
      <div class="song-info">
        <div class="song-title" id="current-song-title">Select a song</div>
        <div class="song-artist" id="current-song-artist"></div>
      </div>
      <div class="like-btn" id="current-song-like">
        <span class="heart-icon">
          <i class="fa fa-heart-o"></i>
          <i class="fa fa-heart"></i>
        </span>
      </div>
    </div>
    
    <div class="player-controls">
      <div class="control-buttons">
        <i class="fas fa-step-backward"></i>
        <button class="play-btn" onclick="togglePlay()">
          <i class="fas fa-play" id="play-icon"></i>
        </button>
        <i class="fas fa-step-forward"></i>
        <i class="fas fa-repeat"></i>
      </div>
      <div class="player-timeline-container">
        <span id="current-time">0:00</span>
        <div class="player-timeline">
          <div class="timeline-progress" id="song-progress"></div>
          <div class="timeline-handle" id="progress-handle"></div>
        </div>
        <span id="song-duration">0:00</span>
      </div>
    </div>
    
    <div class="volume-controls">
      <i class="fas fa-volume-up" id="volume-icon"></i>
      <div class="volume-slider-container">
        <div class="volume-bar">
          <div class="volume-progress"></div>
          <div class="volume-handle"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio element to handle actual playback -->
  <audio id="audio-player" src=""></audio>
  <script>
    // Prevent text selection to avoid flickering
    document.addEventListener('mousedown', function(e) {
      if (e.detail > 1) {
        e.preventDefault();
      }
    }, false);

    const firebaseConfig = {
  apiKey: "AIzaSyBxcD2JrLAtiybztSQyLcXsJRxoM0n4JOk",
  authDomain: "kimify-9672d.firebaseapp.com",
  projectId: "kimify-9672d",
  storageBucket: "kimify-9672d.firebasestorage.app",
  messagingSenderId: "68047655339",
  appId: "1:68047655339:web:f931d51fbae8bec23002ee",
  measurementId: "G-L40TWKYY90"
};
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const playlistsRef = db.collection('playlists');
    const songsRef = db.collection('songs');
    
    // Initialize songs collection if it doesn't exist (only run this once)
    function initializeDatabase() {
      // Check if songs collection already has data
      songsRef.limit(1).get().then(snapshot => {
        if (snapshot.empty) {
          // Add each song to Firestore
          songs.forEach(song => {
            songsRef.doc(song.id).set(song);
          });
          console.log("Songs collection initialized");
        } else {
          console.log("Songs collection already exists");
        }
      });
    
      // Check if playlists collection already has data
      playlistsRef.limit(1).get().then(snapshot => {
        if (snapshot.empty) {
          // Add default playlists to Firestore
          defaultPlaylists.forEach(playlist => {
            playlistsRef.doc(playlist.id).set({
              ...playlist,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          });
          console.log("Playlists collection initialized");
        } else {
          console.log("Playlists collection already exists");
        }
      });
    }
    
    // Mock data for songs
    const songs = [
      { 
        id: 'song1', 
        title: 'Rather Kim', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim1.png', 
        audioFile: 'kim1.mp3' 
      },
      { 
        id: 'song2', 
        title: 'Towards Kim', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim2.png', 
        audioFile: 'kim2.mp3' 
      },
      { 
        id: 'song3', 
        title: 'This Kim', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim3.png', 
        audioFile: 'kim3.mp3' 
      },
      { 
        id: 'song4', 
        title: 'That\'s Kim', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim4.png', 
        audioFile: 'kim4.mp3' 
      },
      { 
        id: 'song5', 
        title: 'Marry Kim', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim5.png', 
        audioFile: 'kim5.mp3' 
      },
      { 
        id: 'song6', 
        title: 'Kim Smile', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim6.png', 
        audioFile: 'kim6.mp3' 
      },
      { 
        id: 'song7', 
        title: 'Kim Cry', 
        artist: 'Kim Jong Un', 
        imageFile: 'kim7.png', 
        audioFile: 'kim7.mp3' 
      },
      { 
        id: 'song8', 
        title: 'Dynamite', 
        artist: 'BTS', 
        imageFile: 'BTS.png', 
        audioFile: 'bts.mp3' 
      }
    ];
    
    // Default playlists
    const defaultPlaylists = [
      {
        id: 'playlist1',
        name: 'Top Kim Songs',
        description: 'The best songs from our Great Leader',
        image: 'kim1.png',
        songs: ['song1', 'song2', 'song3']
      },
      {
        id: 'playlist2',
        name: 'Kim is the Greatest',
        description: 'A collection of hits celebrating our Supreme Leader',
        image: 'kim2.png',
        songs: ['song2', 'song4', 'song6']
      },
      {
        id: 'playlist3',
        name: 'PYONGYANG ANTHEM',
        description: 'Official anthems of our glorious capital',
        image: 'kim3.png',
        songs: ['song3', 'song5', 'song7']
      }
    ];
    
    // Keep track of the current song and play state
    let currentSong = null;
    let isPlaying = false;
    const audioPlayer = document.getElementById('audio-player');
    
    // Initialize volume
    audioPlayer.volume = 0.7; // 70% volume by default
    
    // Track whether we're dragging the timeline handle
    let isDraggingProgress = false;
    let isDraggingVolume = false;
    
    // Local storage keys
    const LIKED_SONGS_KEY = 'kimify-liked-songs';
    const RECENTLY_PLAYED_KEY = 'kimify-recently-played';
    
    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Firebase data if needed (only needed the first time)
      initializeDatabase();
      
      // Load songs to the home view
      loadSongs();
      
      // Setup navigation
      setupNavigation();
      
      // Initialize search functionality
      initSearch();
      
      // Load playlists from Firebase
      loadPlaylists();
      
      // Setup like button functionality
      document.getElementById('current-song-like').addEventListener('click', toggleLikeSong);
      
      // Initialize volume display
      setVolumePercent(audioPlayer.volume);
      
      // Setup add playlist button
      document.getElementById('add-playlist-btn').addEventListener('click', showAddPlaylistModal);
    });
    
    // Function to load songs to the home view
    function loadSongs() {
      const songsGrid = document.getElementById('songs-grid');
      songsGrid.innerHTML = '';
      
      // Get songs from Firebase
      songsRef.get().then(snapshot => {
        snapshot.forEach(doc => {
          const song = doc.data();
          const songCard = document.createElement('div');
          songCard.className = 'song-card';
          songCard.dataset.songId = song.id;
          
          if (song.id === 'song8') {
            // BTS song should show the error dialog
            songCard.onclick = showErrorDialog;
          } else {
            songCard.onclick = () => playSong(song.id);
          }
          
          songCard.innerHTML = `
            <div class="song-img-container">
              <img src="images/${song.imageFile}" alt="${song.title}" class="song-img">
            </div>
            <div class="song-info-container">
              <div class="song-title">${song.title}</div>
              <div class="song-artist">${song.artist}</div>
            </div>
          `;
          
          songsGrid.appendChild(songCard);
        });
      }).catch(error => {
        console.error("Error loading songs:", error);
        songsGrid.innerHTML = '<p>Error loading songs. Please refresh the page.</p>';
      });
    }
    
    // Function to load playlists
    function loadPlaylists() {
      const playlistsContainer = document.getElementById('playlists-container');
      
      // Show loading spinner
      playlistsContainer.innerHTML = '<div class="loader"></div>';
      
      // Set up a real-time listener for playlists
      playlistsRef.orderBy('createdAt', 'desc').onSnapshot(snapshot => {
        playlistsContainer.innerHTML = '';
        
        if (snapshot.empty) {
          playlistsContainer.innerHTML = '<p>No playlists found.</p>';
          return;
        }
        
        snapshot.forEach(doc => {
          const playlist = doc.data();
          const li = document.createElement('li');
          li.dataset.playlistId = doc.id;
          li.onclick = () => loadPlaylistView(doc.id);
          
          li.innerHTML = `
            <img src="images/${playlist.image}" alt="${playlist.name}" class="playlist-mini-img">
            ${playlist.name}
          `;
          
          playlistsContainer.appendChild(li);
        });
      }, error => {
        console.error("Error loading playlists: ", error);
        playlistsContainer.innerHTML = '<p>Error loading playlists. Please refresh the page.</p>';
      });
    }
    
    // Function to setup navigation
    function setupNavigation() {
      // Home
      document.getElementById('home-link').addEventListener('click', function() {
        showView('home-view');
      });
      
      // Search
      document.getElementById('search-link').addEventListener('click', function() {
        showView('search-view');
      });
      
      // Recently Played
      document.getElementById('recently-played-link').addEventListener('click', function() {
        showView('recently-played-view');
        loadRecentlyPlayed();
      });
      
      // Liked Songs
      document.getElementById('liked-songs-link').addEventListener('click', function() {
        showView('liked-songs-view');
        loadLikedSongs();
      });
    }
    
    // Function to show a specific view
    function showView(viewId) {
      // Hide all views
      document.querySelectorAll('#main-content > div').forEach(view => {
        view.style.display = 'none';
      });
      
      // Show the selected view
      document.getElementById(viewId).style.display = 'block';
    }
    
    // Function to initialize search functionality
    function initSearch() {
      const searchInput = document.getElementById('search-input');
      const clearSearch = document.getElementById('clear-search');
      const searchResults = document.getElementById('search-results');
      const searchMessage = document.getElementById('search-message');
      
      // Handle input event
      searchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        
        if (query.length > 0) {
          clearSearch.style.display = 'block';
          searchMessage.style.display = 'none';
          
          // Search in Firebase
          songsRef.get().then(snapshot => {
            const filteredSongs = [];
            
            snapshot.forEach(doc => {
              const song = doc.data();
              if (song.title.toLowerCase().includes(query) || 
                  song.artist.toLowerCase().includes(query)) {
                filteredSongs.push(song);
              }
            });
            
            // Display results
            if (filteredSongs.length > 0) {
              displaySearchResults(filteredSongs);
            } else {
              searchResults.innerHTML = `
                <div class="search-message">
                  <p>No results found for "${query}"</p>
                </div>
              `;
            }
          }).catch(error => {
            console.error("Error searching songs:", error);
            searchResults.innerHTML = `
              <div class="search-message">
                <p>Error searching. Please try again.</p>
              </div>
            `;
          });
        } else {
          clearSearch.style.display = 'none';
          searchResults.innerHTML = '';
          searchMessage.style.display = 'block';
        }
      });
      
      // Clear search button
      clearSearch.addEventListener('click', function() {
        searchInput.value = '';
        searchInput.focus();
        clearSearch.style.display = 'none';
        searchResults.innerHTML = '';
        searchMessage.style.display = 'block';
      });
    }
    
    // Function to display search results
    function displaySearchResults(results) {
      const searchResults = document.getElementById('search-results');
      
      searchResults.innerHTML = `
        <h2 class="section-title">Results</h2>
        <table class="playlist-songs">
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            ${results.map((song, index) => `
              <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                <td class="song-number">${index + 1}</td>
                <td>
                  <div class="song-cell">
                    <div class="song-cell-img">
                      <img src="images/${song.imageFile}" alt="${song.title}">
                    </div>
                    <div class="song-cell-info">
                      <div class="song-cell-title">${song.title}</div>
                      <div class="song-cell-artist">${song.artist}</div>
                    </div>
                  </div>
                </td>
                <td>3:45</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }
    
    // Function to load a specific playlist view
    function loadPlaylistView(playlistId) {
      const playlistView = document.getElementById('playlist-view');
      playlistView.innerHTML = '<div class="loader"></div>';
      
      // Show playlist view while loading
      showView('playlist-view');
      
      // Get the playlist document
      playlistsRef.doc(playlistId).get().then(doc => {
        if (!doc.exists) {
          playlistView.innerHTML = '<p>Playlist not found.</p>';
          return;
        }
        
        const playlist = doc.data();
        
        // Get all songs in this playlist
        getSongsFromPlaylist(playlist.songs).then(playlistSongs => {
          // Populate the playlist view
          playlistView.innerHTML = `
            <div class="playlist-header">
              <div class="playlist-cover">
                <img src="images/${playlist.image}" alt="${playlist.name}">
              </div>
              <div class="playlist-info">
                <div class="playlist-type">Playlist</div>
                <h1 class="playlist-title">${playlist.name}</h1>
                <div class="playlist-description">${playlist.description}</div>
                <div class="playlist-meta">${playlistSongs.length} songs</div>
              </div>
            </div>
            
            <table class="playlist-songs">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                ${playlistSongs.map((song, index) => `
                  <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                    <td class="song-number">${index + 1}</td>
                    <td>
                      <div class="song-cell">
                        <div class="song-cell-img">
                          <img src="images/${song.imageFile}" alt="${song.title}">
                        </div>
                        <div class="song-cell-info">
                          <div class="song-cell-title">${song.title}</div>
                          <div class="song-cell-artist">${song.artist}</div>
                        </div>
                      </div>
                    </td>
                    <td>3:45</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }).catch(error => {
          console.error("Error getting playlist songs: ", error);
          playlistView.innerHTML = '<p>Error loading playlist songs. Please try again.</p>';
        });
      }).catch(error => {
        console.error("Error loading playlist: ", error);
        playlistView.innerHTML = '<p>Error loading playlist. Please try again.</p>';
      });
    }
    
    // Helper function to get songs from a playlist
    async function getSongsFromPlaylist(songIds) {
      if (!songIds || songIds.length === 0) return [];
      
      try {
        // Get all songs from Firestore
        const snapshot = await songsRef.where(firebase.firestore.FieldPath.documentId(), 'in', songIds).get();
        
        // Map to array and maintain order
        const songs = {};
        snapshot.forEach(doc => {
          songs[doc.id] = doc.data();
        });
        
        // Return songs in the same order as the songIds array
        return songIds.map(id => songs[id]).filter(Boolean);
      } catch (error) {
        console.error("Error fetching songs:", error);
        return [];
      }
    }
    
    // Function to play a song
    function playSong(songId) {
      // Get song from Firebase
      songsRef.doc(songId).get().then(doc => {
        if (!doc.exists) {
          console.error("Song not found:", songId);
          return;
        }
        
        const song = doc.data();
        currentSong = song;
        
        // Update the current song display
        document.getElementById('current-song-title').textContent = song.title;
        document.getElementById('current-song-artist').textContent = song.artist;
        
        // Set the image in the player
        const currentSongImg = document.createElement('img');
        currentSongImg.src = `images/${song.imageFile}`;
        currentSongImg.alt = song.title;
        currentSongImg.className = 'now-playing-img';
        
        const imgContainer = document.getElementById('current-song-img-container');
        imgContainer.innerHTML = '';
        imgContainer.appendChild(currentSongImg);
        
        // Set the audio source
        audioPlayer.src = `audio/${song.audioFile}`;
        
        // Play the song
        audioPlayer.load();
        audioPlayer.play().catch(e => {
          console.log("Audio playback failed. This is normal if no audio file exists yet.", e);
        });
        
        isPlaying = true;
        updatePlayButton();
        
        // Update like button state
        updateLikeButton();
        
        // Add to recently played
        addToRecentlyPlayed(songId);
      }).catch(error => {
        console.error("Error loading song:", error);
      });
    }
    
    // Function to toggle play/pause
    function togglePlay() {
      if (!currentSong) return;
      
      if (isPlaying) {
        audioPlayer.pause();
      } else {
        audioPlayer.play().catch(e => {
          console.log("Audio playback failed.", e);
        });
      }
      
      isPlaying = !isPlaying;
      updatePlayButton();
    }
    
    // Update the play/pause button icon
    function updatePlayButton() {
      const playIcon = document.getElementById('play-icon');
      playIcon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
    }
    
    // Format time in minutes:seconds
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      seconds = Math.floor(seconds % 60);
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // Update progress bar and time displays based on actual audio playback
    audioPlayer.addEventListener('timeupdate', function() {
      if (audioPlayer.duration && !isDraggingProgress) {
        const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        const progressBar = document.getElementById('song-progress');
        const progressHandle = document.getElementById('progress-handle');
        
        progressBar.style.width = `${percent}%`;
        progressHandle.style.right = `${100 - percent}%`;
        
        // Update time displays
        document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
        document.getElementById('song-duration').textContent = formatTime(audioPlayer.duration);
      }
    });
    
    // When metadata is loaded, update the duration display
    audioPlayer.addEventListener('loadedmetadata', function() {
      document.getElementById('song-duration').textContent = formatTime(audioPlayer.duration);
    });
    
    // Timeline seeking with dragging
    const playerTimeline = document.querySelector('.player-timeline');
    const progressHandle = document.getElementById('progress-handle');
    playerTimeline.addEventListener('mousedown', function(e) {
      if (!currentSong) return;
      
      const timeline = this;
      const rect = timeline.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      
      if (e.target === progressHandle) {
        // Start dragging the handle
        isDraggingProgress = true;
        document.addEventListener('mousemove', handleProgressDrag);
        document.addEventListener('mouseup', stopProgressDrag);
      } else {
        // Just a click, seek immediately
        seekToPercent(percent);
      }
    });
    
    function handleProgressDrag(e) {
      const timeline = document.querySelector('.player-timeline');
      const rect = timeline.getBoundingClientRect();
      let percent = (e.clientX - rect.left) / rect.width;
      
      // Clamp between 0 and 1
      percent = Math.max(0, Math.min(1, percent));
      
      // Update visuals but don't seek yet
      document.getElementById('song-progress').style.width = `${percent * 100}%`;
      progressHandle.style.right = `${100 - (percent * 100)}%`;
      document.getElementById('current-time').textContent = formatTime(percent * audioPlayer.duration);
    }
    
    function stopProgressDrag(e) {
      isDraggingProgress = false;
      document.removeEventListener('mousemove', handleProgressDrag);
      document.removeEventListener('mouseup', stopProgressDrag);
      
      // Now seek to the final position
      const timeline = document.querySelector('.player-timeline');
      const rect = timeline.getBoundingClientRect();
      let percent = (e.clientX - rect.left) / rect.width;
      percent = Math.max(0, Math.min(1, percent));
      
      seekToPercent(percent);
    }
    
    function seekToPercent(percent) {
      if (!audioPlayer.duration) return;
      
      audioPlayer.currentTime = percent * audioPlayer.duration;
      
      // Update displays
      document.getElementById('song-progress').style.width = `${percent * 100}%`;
      progressHandle.style.right = `${100 - (percent * 100)}%`;
      document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
    }
    
    // Volume control with dragging
    const volumeBar = document.querySelector('.volume-bar');
    const volumeHandle = document.querySelector('.volume-handle');
    const volumeProgress = document.querySelector('.volume-progress');
    
    volumeBar.addEventListener('mousedown', function(e) {
      const volumeBarRect = volumeBar.getBoundingClientRect();
      let percent = (e.clientX - volumeBarRect.left) / volumeBarRect.width;
      percent = Math.max(0, Math.min(1, percent));
      
      if (e.target === volumeHandle) {
        // Start dragging
        isDraggingVolume = true;
        document.addEventListener('mousemove', handleVolumeDrag);
        document.addEventListener('mouseup', stopVolumeDrag);
      } else {
        // Just a click
        setVolumePercent(percent);
      }
    });
    
    function handleVolumeDrag(e) {
      const volumeBarRect = volumeBar.getBoundingClientRect();
      let percent = (e.clientX - volumeBarRect.left) / volumeBarRect.width;
      percent = Math.max(0, Math.min(1, percent));
      
      setVolumePercent(percent);
    }
    
    function stopVolumeDrag() {
      isDraggingVolume = false;
      document.removeEventListener('mousemove', handleVolumeDrag);
      document.removeEventListener('mouseup', stopVolumeDrag);
    }
    
    function setVolumePercent(percent) {
      audioPlayer.volume = percent;
      volumeProgress.style.width = `${percent * 100}%`;
      volumeHandle.style.right = `${100 - (percent * 100)}%`;
      
      // Update volume icon
      const volumeIcon = document.getElementById('volume-icon');
      if (percent === 0) {
        volumeIcon.className = 'fas fa-volume-mute';
      } else if (percent < 0.5) {
        volumeIcon.className = 'fas fa-volume-down';
      } else {
        volumeIcon.className = 'fas fa-volume-up';
      }
    }
    
    // Toggle mute on volume icon click
    document.getElementById('volume-icon').addEventListener('click', function() {
      if (audioPlayer.volume > 0) {
        // Store the current volume for unmuting
        audioPlayer.dataset.prevVolume = audioPlayer.volume;
        setVolumePercent(0);
      } else {
        // Restore previous volume or set to 70% if not stored
        const prevVolume = parseFloat(audioPlayer.dataset.prevVolume) || 0.7;
        setVolumePercent(prevVolume);
      }
    });
    
    // Handle song end
    audioPlayer.addEventListener('ended', function() {
      isPlaying = false;
      updatePlayButton();
    });
    
    // Forward and backward buttons
    document.querySelector('.fa-step-forward').addEventListener('click', function() {
      if (!currentSong || !audioPlayer.duration) return;
      audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10);
    });
    
    document.querySelector('.fa-step-backward').addEventListener('click', function() {
      if (!currentSong) return;
      audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10);
    });
    
    // Function to show North Korean error dialog
    function showErrorDialog() {
      const overlay = document.createElement('div');
      overlay.className = 'error-overlay';
      
      const dialog = document.createElement('div');
      dialog.className = 'error-dialog';
      
      // Title bar
      const titleBar = document.createElement('div');
      titleBar.className = 'error-title-bar';
      titleBar.innerHTML = '<span>DPRK System Error</span><span class="close-btn"></span>';
      
      // Content
      const content = document.createElement('div');
      content.className = 'error-content';
      
      // Flag image
      const flagImg = document.createElement('img');
      flagImg.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Flag_of_North_Korea.svg/800px-Flag_of_North_Korea.svg.png';
      flagImg.alt = 'North Korea Flag';
      
      // Error message
      const message = document.createElement('div');
      message.className = 'error-message';
      message.innerHTML = `
        <b>CRITICAL ERROR #9458</b><br><br>
        You have attempted to access forbidden South Korean cultural material.<br><br>
        This violation of the Democratic People's Republic of Korea's laws has been recorded.<br><br>
        Your IP address and location have been forwarded to authorities.<br><br>
        <b>Penalty:</b> Re-education through labor (3-5 years)
      `;
      
      content.appendChild(flagImg);
      content.appendChild(message);
      
      // Buttons
      const buttons = document.createElement('div');
      buttons.className = 'error-buttons';
      
      const okButton = document.createElement('button');
      okButton.className = 'error-button';
      okButton.textContent = 'Accept Punishment';
      
      buttons.appendChild(okButton);
      
      // Assemble dialog
      dialog.appendChild(titleBar);
      dialog.appendChild(content);
      dialog.appendChild(buttons);
      
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);
      
      // Event listeners
      titleBar.querySelector('.close-btn').addEventListener('click', function() {
        document.body.removeChild(overlay);
      });
      
      okButton.addEventListener('click', function() {
        document.body.removeChild(overlay);
      });
    }
    // Liked songs functionality
    function getLikedSongs() {
      const likedSongs = localStorage.getItem(LIKED_SONGS_KEY);
      return likedSongs ? JSON.parse(likedSongs) : [];
    }
    
    function saveLikedSongs(likedSongs) {
      localStorage.setItem(LIKED_SONGS_KEY, JSON.stringify(likedSongs));
    }
    
    function isSongLiked(songId) {
      const likedSongs = getLikedSongs();
      return likedSongs.includes(songId);
    }
    
    function toggleLikeSong() {
      if (!currentSong) return;
      
      const songId = currentSong.id;
      const likedSongs = getLikedSongs();
      
      if (isSongLiked(songId)) {
        // Unlike the song
        const index = likedSongs.indexOf(songId);
        if (index !== -1) {
          likedSongs.splice(index, 1);
        }
      } else {
        // Like the song
        likedSongs.push(songId);
      }
      
      saveLikedSongs(likedSongs);
      updateLikeButton();
      
      // If we're in the liked songs view, refresh it
      if (document.getElementById('liked-songs-view').style.display !== 'none') {
        loadLikedSongs();
      }
    }
    
    function updateLikeButton() {
      if (!currentSong) return;
      
      const likeBtn = document.getElementById('current-song-like');
      
      if (isSongLiked(currentSong.id)) {
        likeBtn.classList.add('active');
      } else {
        likeBtn.classList.remove('active');
      }
    }
    
    function loadLikedSongs() {
      const likedSongsContainer = document.getElementById('liked-songs-container');
      const emptyMessage = document.getElementById('liked-songs-empty');
      
      const likedSongIds = getLikedSongs();
      
      if (likedSongIds.length === 0) {
        likedSongsContainer.innerHTML = '';
        emptyMessage.style.display = 'block';
        return;
      }
      
      // Show loading spinner
      likedSongsContainer.innerHTML = '<div class="loader"></div>';
      emptyMessage.style.display = 'none';
      
      // Get the song objects from Firebase
      getSongsFromPlaylist(likedSongIds).then(likedSongs => {
        if (likedSongs.length === 0) {
          likedSongsContainer.innerHTML = '';
          emptyMessage.style.display = 'block';
          return;
        }
        
        likedSongsContainer.innerHTML = `
          <table class="playlist-songs">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody>
              ${likedSongs.map((song, index) => `
                <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                  <td class="song-number">${index + 1}</td>
                  <td>
                    <div class="song-cell">
                      <div class="song-cell-img">
                        <img src="images/${song.imageFile}" alt="${song.title}">
                      </div>
                      <div class="song-cell-info">
                        <div class="song-cell-title">${song.title}</div>
                        <div class="song-cell-artist">${song.artist}</div>
                      </div>
                    </div>
                  </td>
                  <td>3:45</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      }).catch(error => {
        console.error("Error loading liked songs:", error);
        likedSongsContainer.innerHTML = '<p>Error loading liked songs. Please try again.</p>';
      });
    }
    
    // Recently played functionality
    function getRecentlyPlayed() {
      const recentlyPlayed = localStorage.getItem(RECENTLY_PLAYED_KEY);
      return recentlyPlayed ? JSON.parse(recentlyPlayed) : [];
    }
    
    function saveRecentlyPlayed(recentlyPlayed) {
      localStorage.setItem(RECENTLY_PLAYED_KEY, JSON.stringify(recentlyPlayed));
    }
    
    function addToRecentlyPlayed(songId) {
      const recentlyPlayed = getRecentlyPlayed();
      
      // Remove if already in the list
      const index = recentlyPlayed.indexOf(songId);
      if (index !== -1) {
        recentlyPlayed.splice(index, 1);
      }
      
      // Add to the beginning
      recentlyPlayed.unshift(songId);
      
      // Keep only the last 20 songs
      if (recentlyPlayed.length > 20) {
        recentlyPlayed.pop();
      }
      
      saveRecentlyPlayed(recentlyPlayed);
    }
    
    function loadRecentlyPlayed() {
      const recentlyPlayedContainer = document.getElementById('recently-played-container');
      const emptyMessage = document.getElementById('recently-played-empty');
      
      const recentlyPlayedIds = getRecentlyPlayed();
      
      if (recentlyPlayedIds.length === 0) {
        recentlyPlayedContainer.innerHTML = '';
        emptyMessage.style.display = 'block';
        return;
      }
      
      // Show loading spinner
      recentlyPlayedContainer.innerHTML = '<div class="loader"></div>';
      emptyMessage.style.display = 'none';
      
      // Get the song objects from Firebase
      getSongsFromPlaylist(recentlyPlayedIds).then(recentSongs => {
        if (recentSongs.length === 0) {
          recentlyPlayedContainer.innerHTML = '';
          emptyMessage.style.display = 'block';
          return;
        }
        
        recentlyPlayedContainer.innerHTML = `
          <table class="playlist-songs">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody>
              ${recentSongs.map((song, index) => `
                <tr data-song-id="${song.id}" ${song.id === 'song8' ? 'onclick="showErrorDialog()"' : `onclick="playSong('${song.id}')"`}>
                  <td class="song-number">${index + 1}</td>
                  <td>
                    <div class="song-cell">
                      <div class="song-cell-img">
                        <img src="images/${song.imageFile}" alt="${song.title}">
                      </div>
                      <div class="song-cell-info">
                        <div class="song-cell-title">${song.title}</div>
                        <div class="song-cell-artist">${song.artist}</div>
                      </div>
                    </div>
                  </td>
                  <td>3:45</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      }).catch(error => {
        console.error("Error loading recently played songs:", error);
        recentlyPlayedContainer.innerHTML = '<p>Error loading recently played songs. Please try again.</p>';
      });
    }
    
    // Function to create a new playlist in Firebase
    function createPlaylist(name, description, image, songs = []) {
      const playlistId = 'playlist-' + Date.now();
      
      return playlistsRef.doc(playlistId).set({
        id: playlistId,
        name: name,
        description: description || 'No description',
        image: image,
        songs: songs,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
    
    // Add playlist modal
    function showAddPlaylistModal() {
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      
      const content = document.createElement('div');
      content.className = 'modal-content';
      
      content.innerHTML = `
        <div class="modal-header">
          <h2>Create Playlist</h2>
        </div>
        
        <div class="modal-form">
          <div class="modal-form-group">
            <label for="playlist-name">Playlist Name</label>
            <input type="text" id="playlist-name" placeholder="My Great Playlist">
          </div>
          
          <div class="modal-form-group">
            <label for="playlist-description">Description</label>
            <textarea id="playlist-description" placeholder="Add an optional description"></textarea>
          </div>
          
          <div class="modal-form-group">
            <label>Cover Image</label>
            <div class="image-selector" id="image-selector">
              ${songs.map(song => `
                <div class="image-option" data-image="${song.imageFile}">
                  <img src="images/${song.imageFile}" alt="Cover Option">
                </div>
              `).join('')}
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button class="modal-btn modal-btn-cancel" id="cancel-playlist">Cancel</button>
          <button class="modal-btn modal-btn-primary" id="create-playlist">Create</button>
        </div>
      `;
      
      overlay.appendChild(content);
      document.body.appendChild(overlay);
      
      // Setup image selector
      const imageOptions = content.querySelectorAll('.image-option');
      let selectedImage = null;
      
      imageOptions.forEach(option => {
        option.addEventListener('click', function() {
          // Remove selected class from all options
          imageOptions.forEach(opt => opt.classList.remove('selected'));
          
          // Add selected class to clicked option
          this.classList.add('selected');
          
          // Store selected image
          selectedImage = this.dataset.image;
        });
      });
      
      // Select first image by default
      if (imageOptions.length > 0) {
        imageOptions[0].click();
      }
      
      // Cancel button
      content.querySelector('#cancel-playlist').addEventListener('click', function() {
        document.body.removeChild(overlay);
      });
      
      // Create button
      content.querySelector('#create-playlist').addEventListener('click', function() {
        const createBtn = this;
        const name = content.querySelector('#playlist-name').value.trim();
        const description = content.querySelector('#playlist-description').value.trim();
        
        if (!name) {
          alert('Please enter a playlist name');
          return;
        }
        
        if (!selectedImage) {
          alert('Please select a cover image');
          return;
        }
        
        // Disable button and show loading state
        createBtn.disabled = true;
        createBtn.innerHTML = 'Creating...';
        
        // Create playlist in Firebase
        createPlaylist(name, description, selectedImage)
          .then(() => {
            // Success - playlist will appear via the real-time listener
            document.body.removeChild(overlay);
          })
          .catch(error => {
            console.error("Error creating playlist:", error);
            alert("Error creating playlist. Please try again.");
            createBtn.disabled = false;
            createBtn.innerHTML = 'Create';
          });
      });
    }
    
    // Function to add a song to a playlist
    function addSongToPlaylist(playlistId, songId) {
      return playlistsRef.doc(playlistId).update({
        songs: firebase.firestore.FieldValue.arrayUnion(songId)
      });
    }
    
    // Function to remove a song from a playlist
    function removeSongFromPlaylist(playlistId, songId) {
      return playlistsRef.doc(playlistId).update({
        songs: firebase.firestore.FieldValue.arrayRemove(songId)
      });
    }
  </script>
</body>
</html>
